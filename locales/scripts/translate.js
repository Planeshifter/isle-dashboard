"use strict";const axios=require("axios"),glob=require("glob"),fs=require("fs"),path=require("path"),qs=require("qs"),replace=require("@stdlib/string/replace"),readJSON=require("@stdlib/fs/read-json"),objectKeys=require("@stdlib/utils/keys"),ENV=require("@stdlib/process/env"),LANGUAGE_TARGETS=["bg","cs","da","de","el","es","et","fi","fr","hu","it","ja","lt","lv","nl","pl","pt","ro","ru","sk","sl","sv","zh"],deepl={server:"https://api.deepl.com/v2/translate",auth_key:ENV.DEEPL_KEY},MAX_TRANSLATION_CALLS=5,TOPLEVEL_DIR=path.resolve(__dirname,"..","..",".."),RE_HANDLEBAR_EXPRESSION=/\{\{([^}]+)\}\}/g,RE_XML_GROUPS=/<x>([^<]+)<\/x>/g,options={cwd:TOPLEVEL_DIR};glob("public/locales/en/*.json",options,(function(e,t){for(let s=0;s<t.length;s++){const e=path.resolve(TOPLEVEL_DIR,t[s]),r=readJSON.sync(e),l=objectKeys(r),n={};for(let t=0;t<l.length;t++){const e=l[t];n[e]=r[e]}fs.writeFileSync(e,JSON.stringify(n,null,"\t").concat("\n"));for(let t=0;t<LANGUAGE_TARGETS.length;t++){const s=LANGUAGE_TARGETS[t],n=e.replace("en",s);fs.existsSync(n)||fs.writeFileSync(n,JSON.stringify({}));const o=readJSON.sync(n),i=[],a=[];for(let e=0;e<l.length;e++){const t=l[e];if(!o[t]){let e=r[t];e=replace(e,RE_HANDLEBAR_EXPRESSION,"<x>$1</x>"),console.log("Translate `"+e+"` to "+s),i.length<5&&(a.push(t),i.push(axios.post(deepl.server,qs.stringify({auth_key:deepl.auth_key,source_lang:"EN",text:e,tag_handling:"xml",ignore_tags:"x",target_lang:"pt"===s?"PT-BR":s.toUpperCase()}))))}}Promise.all(i).then((e=>{const t=e.map((e=>e.data.translations[0].text));for(let r=0;r<a.length;r++){const e=a[r],s=replace(t[r],RE_XML_GROUPS,"{{$1}}");o[e]=s}l.sort(((e,t)=>e.localeCompare(t)));const s={};for(let r=0;r<l.length;r++){const e=l[r];s[e]=o[e]}fs.writeFileSync(n,JSON.stringify(s,null,"\t").concat("\n"))})).catch((e=>{console.error(e)}))}}}));