{"version":3,"sources":["components/async/spinner.js","components/async/index.js","actions/lesson.js","actions/settings.js","constants/action_types.js","actions/notification.js","reducers/admin.js","reducers/badges.js","reducers/cohorts.js","reducers/namespace.js","reducers/notification.js","reducers/settings.js","reducers/gallery.js","reducers/search.js","reducers/user.js","reducers/index.js","containers/notification.js","containers/app.js","helpers/i18n.js","service_worker.js","index.js","constants/server.js","actions/cohort.js","actions/authentication.js","actions/user.js"],"names":["Spinner","className","asyncComponent","importComponent","props","state","component","a","default","this","setState","C","Component","deletedLesson","lessonName","type","DELETED_LESSON","payload","updatedLesson","UPDATED_LESSON","retrievedLessons","lessons","namespaceName","RETRIEVED_LESSONS","getPublicLessons","dispatch","axios","get","server","res","data","RETRIEVED_PUBLIC_LESSONS","addErrorNotification","getPublicLessonsInjector","getIsleFile","qs","stringify","getIsleFileInjector","file","getLessons","map","lesson","index","colorIndex","url","title","lockUntil","Date","time","createdAt","toLocaleString","updatedAt","getLessonsInjector","copyLesson","sourceName","target","targetName","source","post","addNotification","message","level","copyLessonInjector","deleteLesson","deleteLessonInjector","showLessonInGallery","public","showLessonInGalleryInjector","hideLessonInGallery","hideLessonInGalleryInjector","activateLesson","active","activateLessonInjector","deactivateLesson","deactivateLessonInjector","updateLesson","newTitle","newDescription","template","query","isBoolean","updateLessonInjector","bool","getAllLessons","GET_ALL_LESSONS","getAllLessonsInjector","getTemplateLessons","templateLessons","GET_TEMPLATE_LESSONS","getTemplateLessonsInjector","getRooms","rooms","GET_ROOMS","getRoomsInjector","getSettings","GET_SETTINGS","getSettingsInjector","getPublicSettings","GET_SETTINGS_PUBLIC","getPublicSettingsInjector","updateSettings","name","value","i18next","t","UPDATED_SETTINGS","updateSettingsInjector","ADD_ENROLLED_NAMESPACE","ADD_ERROR_NOTIFICATION","ADD_NOTIFICATION","APPEND_CREATED_NAMESPACE","AUTHENTICATED","CHANGED_NAMESPACE","CREATED_ANNOUNCEMENT","CREATED_CUSTOM_FIELD","CREATED_BACKUP","CREATED_TICKET","DELETED_BACKUP","DELETED_CURRENT_NAMESPACE","DELETED_CUSTOM_FIELD","DELETED_EVENT","DELETED_FILE","DELETED_TICKET","DELETED_USER","DELETED_ANNOUNCEMENT","DISABLED_TFA","EDITED_ANNOUNCEMENT","ENABLED_TFA","FIELD_POSITION_DECREMENTED","FIELD_POSITION_INCREMENTED","GET_ALL_COHORTS","GET_ALL_FILES","GET_ALL_NAMESPACES","GET_BACKUPS","GET_EVENTS","GET_ALL_TICKETS","GET_COURSE_TICKETS","GET_CUSTOM_FIELDS","GET_OVERVIEW_STATISTICS","GET_HISTORICAL_OVERVIEW_STATISTICS","GET_REQUEST_STATISTICS","GET_TFA_QRCODE","GET_USERS","GET_USER_TICKETS","LESSON_ORDER","LESSON_ORDER_DIRECTION","RECEIVED_FILES","RECEIVED_LICENSE","RECEIVED_NAMESPACE_FILES","RECEIVED_TOKEN","REMOVED_LICENSE","REQUEST_TFA","RETRIEVED_BADGES","RETRIEVED_COHORTS","SEARCH_PHRASE_SET","TICKET_CLOSED","TICKET_OPENED","TICKET_MESSAGE_ADDED","TICKET_PRIORITY_UPDATED","TRIGGERED_EVENT","UPDATED_OWNED_NAMESPACE","LOGGED_IN","LOGGED_OUT","USER_UPDATED","USER_UPDATED_BY_ADMIN","USER_PICTURE_MODIFIED","USER_RECEIVED_BADGES","UPDATED_CUSTOM_FIELD","UPDATED_STUDENT_PROGRESS","RETRIEVED_ENROLLABLE_COHORTS","notification","addNotificationInjector","err","msg","response","status","initialState","cohorts","events","files","lessonsMap","namespaces","tickets","users","statistics","requestStatistics","historicalStatistics","backups","license","settings","admin","action","types","x","keys","objectKeys","lessonData","chatMessages","nActions","i","length","key","actionTypes","j","Object","assign","startDate","endDate","slice","filter","_id","id","startTime","done","user","ticket","priority","picture","substring","lastIndexOf","messages","unshift","indexOf","push","backup","badges","titleCompare","b","localeCompare","isArray","elem","emailFilter","isRegExpString","reFromString","test","email","contains","sort","description","owners","enableTicketing","announcements","ownerFiles","namespace","cohort","lessonID","progress","members","member","hasOwnProp","newState","owner","announcement","splice","position","children","autoDismiss","phrase","direction","search","lowercase","LOCATION_CHANGE","loggedIn","verifiedEmail","organization","writeAccess","administrator","enrolledNamespaces","ownedNamespaces","score","spentTime","token","licensed","customFields","availableCustomFields","twoFactorAuth","requestTFA","getNamespace","arr","item","course","copy","ns","groupBy","v","fields","verified","disabled","password","style","NotificationItem","DefaultStyle","margin","info","color","backgroundColor","boxShadow","height","width","borderTop","NotificationContainer","prevProps","prevState","notificationSystem","ref","connect","AsyncFooterBar","AsyncTerms","AsyncPrivacy","AsyncHeaderBar","AsyncForgotPassword","AsyncCreateNamespace","AsyncEditNamespace","AsyncNewPassword","AsyncCompleteRegistration","AsyncConfirmEmail","AsyncShibboleth","AsyncAdminPage","AsyncAdminSettings","AsyncLogin","AsyncLoginTFA","AsyncSignup","AsyncNamespaceData","AsyncGallery","AsyncLessonsPage","AsyncProfilePage","AsyncEnrollPage","USER_STORAGE_ID","ALL_LOGGEDIN_PATHS","RE_PUBLIC_PAGES","debug","logger","App","history","isLoggedIn","location","pathname","isle","localStorage","getItem","JSON","parse","fetchCredentials","getEnrollableCohorts","replace","setItem","isLoggingOut","isLoggingIn","path","AuthenticationBarrier","exact","allowUserRegistrations","fetchCredentialsInjector","getEnrollableCohortsInjector","i18n","use","Backend","LanguageDetector","initReactI18next","init","lng","fallbackLng","backend","loadPath","react","useSuspense","interpolation","escapeValue","isLocalhost","Boolean","window","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","console","log","onUpdate","onSuccess","catch","error","persistConfig","blacklist","storage","localforage","createHashHistory","rootReducer","combineReducers","gallery","router","connectRouter","persistedReducer","persistReducer","middleware","routerMiddleware","store","createStore","applyMiddleware","persistor","persistStore","interceptors","request","headers","language","getState","Authorization","ReactDOM","render","loading","document","getElementById","addEventListener","origin","fetch","contentType","ready","unregister","reload","checkValidServiceWorker","publicUrl","retrievedEnrollableCohorts","getCohorts","namespaceID","retrievedCohorts","addUserToCohort","cohortID","addUserToCohortInjector","deleteCohort","deleteCohortInjector","createCohort","createCohortInjector","updateCohort","newEmails","join","dismissible","updateCohortInjector","getAllCohorts","getAllCohortsInjector","sanitizeUser","newOwnedNamespaces","ids","Set","has","add","newEnrolledNamespaces","needsSanitizing","sanitizeRequest","sanitizeRequestInjector","result","obj","sanitizedUser","shibboleth","eppn","affil","salt","receivedToken","shibbolethInjector","getUsers","getUsersInjector","impersonateUser","impersonateUserInjector","deleteUser","deleteUserInjector","uploadProfilePic","avatarData","thumbnailData","filename","uploadProfilePicInjector","authenticate","writeAccessToken","authenticateInjector","forgotPassword","forgotPasswordInjector","updateUser","form","updateUserInjector","createUser","handleLogin","handleLoginInjector","handleLoginTFA","handleLoginTFAInjector","restoreLoginInjector","restoreLogin","logout","removeItem","logoutInjector","userUpdateCheck","hasMostRecent","newUser","userUpdateCheckInjector","confirmEmail","resendConfirmEmail","resendConfirmEmailInjector","adminUpdateUser","adminUpdateUserInjector"],"mappings":"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","file":"static/js/main.07fdab25.chunk.js","sourcesContent":["/**\n* The MIT License (MIT)\n*\n* Copyright (c) 2015 Tobias Ahlin\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy of\n* this software and associated documentation files (the \"Software\"), to deal in\n* the Software without restriction, including without limitation the rights to\n* use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n* the Software, and to permit persons to whom the Software is furnished to do so,\n* subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n* FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n* COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n* IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n* CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n\n// MODULES //\n\nimport React from 'react';\n\n\n// MAIN //\n\nconst Spinner = () => {\n\treturn ( <div className=\"sk-cube-grid\">\n\t\t<div className=\"sk-cube sk-cube1\"></div>\n\t\t<div className=\"sk-cube sk-cube2\"></div>\n\t\t<div className=\"sk-cube sk-cube3\"></div>\n\t\t<div className=\"sk-cube sk-cube4\"></div>\n\t\t<div className=\"sk-cube sk-cube5\"></div>\n\t\t<div className=\"sk-cube sk-cube6\"></div>\n\t\t<div className=\"sk-cube sk-cube7\"></div>\n\t\t<div className=\"sk-cube sk-cube8\"></div>\n\t\t<div className=\"sk-cube sk-cube9\"></div>\n\t</div> );\n};\n\n\n// EXPORTS //\n\nexport default Spinner;\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React, { Component } from 'react';\nimport Spinner from './spinner.js';\n\n\n// MAIN //\n\nfunction asyncComponent( importComponent ) {\n\tclass AsyncComponent extends Component {\n\t\tconstructor( props ) {\n\t\t\tsuper( props );\n\n\t\t\tthis.state = {\n\t\t\t\tcomponent: null\n\t\t\t};\n\t\t}\n\n\t\tasync componentDidMount() {\n\t\t\tconst { default: component } = await importComponent();\n\t\t\tthis.setState({ // eslint-disable-line react/no-did-mount-set-state\n\t\t\t\tcomponent: component\n\t\t\t});\n\t\t}\n\n\t\trender() {\n\t\t\tconst C = this.state.component;\n\t\t\treturn C ? <C {...this.props} /> : <Spinner />;\n\t\t}\n\t}\n\treturn AsyncComponent;\n}\n\n\n// EXPORTS //\n\nexport default asyncComponent;\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport axios from 'axios';\nimport qs from 'querystring';\nimport server from 'constants/server';\nimport { isPrimitive as isBoolean } from '@stdlib/assert/is-boolean';\nimport { addNotification, addErrorNotification } from 'actions/notification';\nimport { DELETED_LESSON, GET_ALL_LESSONS, GET_TEMPLATE_LESSONS, GET_ROOMS, UPDATED_LESSON, RETRIEVED_LESSONS, RETRIEVED_PUBLIC_LESSONS } from 'constants/action_types.js';\n\n\n// EXPORTS //\n\nexport function deletedLesson( lessonName ) {\n\treturn {\n\t\ttype: DELETED_LESSON,\n\t\tpayload: {\n\t\t\tlessonName\n\t\t}\n\t};\n}\n\nexport function updatedLesson( lessonName, props ) {\n\treturn {\n\t\ttype: UPDATED_LESSON,\n\t\tpayload: {\n\t\t\tlessonName,\n\t\t\tprops\n\t\t}\n\t};\n}\n\nexport function retrievedLessons({ lessons, namespaceName }) {\n\treturn {\n\t\ttype: RETRIEVED_LESSONS,\n\t\tpayload: {\n\t\t\tlessons,\n\t\t\tnamespaceName\n\t\t}\n\t};\n}\n\nexport function retrievedAllLessons( lessons ) {\n\treturn {\n\t\ttype: GET_ALL_LESSONS,\n\t\tpayload: {\n\t\t\tlessons\n\t\t}\n\t};\n}\n\nexport function retrievedTemplateLessons( templateLessons ) {\n\treturn {\n\t\ttype: GET_TEMPLATE_LESSONS,\n\t\tpayload: {\n\t\t\ttemplateLessons\n\t\t}\n\t};\n}\n\nexport function retrievedRooms( rooms ) {\n\treturn {\n\t\ttype: GET_ROOMS,\n\t\tpayload: {\n\t\t\trooms\n\t\t}\n\t};\n}\n\nexport function retrievedPublicLessons( lessons ) {\n\treturn {\n\t\ttype: RETRIEVED_PUBLIC_LESSONS,\n\t\tpayload: {\n\t\t\tlessons\n\t\t}\n\t};\n}\n\nexport const getPublicLessons = async ( dispatch ) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/get_public_lessons' );\n\t\tdispatch( retrievedPublicLessons( res.data.lessons ) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const getPublicLessonsInjector = ( dispatch ) => {\n\treturn async () => {\n\t\tawait getPublicLessons( dispatch );\n\t};\n};\n\nexport const getIsleFile = async ( dispatch, { lessonName, namespaceName }) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/get_isle_file?'+qs.stringify({\n\t\t\tlessonName,\n\t\t\tnamespaceName\n\t\t}) );\n\t\treturn res.data;\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t\treturn null;\n\t}\n};\n\nexport const getIsleFileInjector = ( dispatch ) => {\n\treturn async ({ lessonName, namespaceName }) => {\n\t\tconst file = await getIsleFile( dispatch, { lessonName, namespaceName });\n\t\treturn file;\n\t};\n};\n\nexport const getLessons = async ( dispatch, namespaceName ) => {\n\tif ( namespaceName ) {\n\t\ttry {\n\t\t\tconst res = await axios.get( server+'/get_lessons?'+qs.stringify({\n\t\t\t\tnamespaceName\n\t\t\t}) );\n\t\t\tlet lessons = res.data.lessons;\n\t\t\tlessons = lessons.map(( lesson, index ) => {\n\t\t\t\tlesson.colorIndex = index % 20;\n\t\t\t\tlesson.url = server+'/'+namespaceName+'/'+lesson.title;\n\t\t\t\tif ( lesson.lockUntil ) {\n\t\t\t\t\tlesson.lockUntil = new Date( lesson.lockUntil.time );\n\t\t\t\t}\n\t\t\t\tif ( !lesson.createdAt ) {\n\t\t\t\t\tlesson.createdAt = new Date( 0 ).toLocaleString();\n\t\t\t\t}\n\t\t\t\tif ( !lesson.updatedAt ) {\n\t\t\t\t\tlesson.updatedAt = lesson.createdAt;\n\t\t\t\t}\n\t\t\t\treturn lesson;\n\t\t\t});\n\t\t\tdispatch( retrievedLessons({ lessons, namespaceName }) );\n\t\t} catch ( err ) {\n\t\t\taddErrorNotification( dispatch, err );\n\t\t}\n\t}\n};\n\nexport const getLessonsInjector = ( dispatch ) => {\n\treturn async ( namespaceName ) => {\n\t\tawait getLessons( dispatch, namespaceName );\n\t};\n};\n\nexport const copyLesson = async ( dispatch, { sourceName, target, targetName, source }) => {\n\tif ( sourceName && target && source ) {\n\t\ttry {\n\t\t\tconst res = await axios.post( server+'/copy_lesson', {\n\t\t\t\ttarget,\n\t\t\t\tsource,\n\t\t\t\tsourceName,\n\t\t\t\ttargetName\n\t\t\t});\n\t\t\taddNotification( dispatch, {\n\t\t\t\tmessage: res.data.message,\n\t\t\t\tlevel: 'success'\n\t\t\t});\n\t\t\treturn res;\n\t\t} catch ( err ) {\n\t\t\taddErrorNotification( dispatch, err );\n\t\t}\n\t}\n};\n\nexport const copyLessonInjector = ( dispatch ) => {\n\treturn async ({ sourceName, target, targetName, source }) => {\n\t\tawait copyLesson( dispatch, { sourceName, target, targetName, source } );\n\t};\n};\n\nexport const deleteLesson = async ( dispatch, { lessonName, namespaceName }) => {\n\tif ( !namespaceName || !lessonName ) {\n\t\treturn;\n\t}\n\ttry {\n\t\tconst res = await axios.post( server+'/delete_lesson', {\n\t\t\tnamespaceName,\n\t\t\tlessonName\n\t\t});\n\t\tdispatch( deletedLesson( lessonName ) );\n\t\taddNotification( dispatch, {\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t\treturn res;\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const deleteLessonInjector = ( dispatch ) => {\n\treturn async ({ lessonName, namespaceName }) => {\n\t\tawait deleteLesson( dispatch, { lessonName, namespaceName } );\n\t};\n};\n\nexport const showLessonInGallery = async ( dispatch, { lessonName, namespaceName }) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/show_lesson', {\n\t\t\tnamespaceName,\n\t\t\tlessonName\n\t\t});\n\t\taddNotification( dispatch, {\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t\tdispatch( updatedLesson( lessonName, { public: true }) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const showLessonInGalleryInjector = ( dispatch ) => {\n\treturn async ({ lessonName, namespaceName }) => {\n\t\tawait showLessonInGallery( dispatch, { lessonName, namespaceName });\n\t};\n};\n\nexport const hideLessonInGallery = async ( dispatch, { lessonName, namespaceName }) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/hide_lesson', {\n\t\t\tnamespaceName,\n\t\t\tlessonName\n\t\t});\n\t\taddNotification( dispatch, {\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t\tdispatch( updatedLesson( lessonName, { public: false }) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const hideLessonInGalleryInjector = ( dispatch ) => {\n\treturn async ({ lessonName, namespaceName }) => {\n\t\tawait hideLessonInGallery( dispatch, { lessonName, namespaceName });\n\t};\n};\n\nexport const activateLesson = async ( dispatch, { lessonName, namespaceName }) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/activate_lesson?', {\n\t\t\tnamespaceName,\n\t\t\tlessonName\n\t\t});\n\t\taddNotification( dispatch, {\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t\tdispatch( updatedLesson( lessonName, { active: true }) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const activateLessonInjector = ( dispatch ) => {\n\treturn async ({ lessonName, namespaceName }) => {\n\t\tawait activateLesson( dispatch, { lessonName, namespaceName });\n\t};\n};\n\nexport const deactivateLesson = async ( dispatch, { lessonName, namespaceName }) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/deactivate_lesson', {\n\t\t\tnamespaceName,\n\t\t\tlessonName\n\t\t});\n\t\taddNotification( dispatch, {\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t\tdispatch( updatedLesson( lessonName, { active: false }) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const deactivateLessonInjector = ( dispatch ) => {\n\treturn async ({ lessonName, namespaceName }) => {\n\t\tawait deactivateLesson( dispatch, { lessonName, namespaceName });\n\t};\n};\n\nexport const updateLesson = async ( dispatch, { lessonName, namespaceName, newTitle, newDescription, lockUntil, template }) => {\n\tif ( namespaceName && lessonName ) {\n\t\ttry {\n\t\t\tconst query = {\n\t\t\t\tnamespaceName,\n\t\t\t\tlessonName,\n\t\t\t\tnewTitle,\n\t\t\t\tnewDescription,\n\t\t\t\tlockUntil\n\t\t\t};\n\t\t\tif ( isBoolean( template ) ) {\n\t\t\t\tquery.template = template;\n\t\t\t}\n\t\t\tconst res = await axios.post( server+'/update_lesson', query );\n\t\t\tdispatch( deletedLesson( lessonName ) );\n\t\t\taddNotification( dispatch, {\n\t\t\t\tmessage: res.data.message,\n\t\t\t\tlevel: 'success'\n\t\t\t});\n\t\t\tgetLessons( dispatch, namespaceName );\n\t\t\treturn true;\n\t\t} catch ( err ) {\n\t\t\taddErrorNotification( dispatch, err );\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn false;\n};\n\nexport const updateLessonInjector = ( dispatch ) => {\n\treturn async ({ lessonName, namespaceName, newTitle, newDescription, lockUntil, template }) => {\n\t\tconst bool = await updateLesson( dispatch, { lessonName, namespaceName, newTitle, newDescription, lockUntil, template });\n\t\treturn bool;\n\t};\n};\n\nexport const getAllLessons = async ( dispatch ) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/get_all_lessons' );\n\t\tdispatch( retrievedAllLessons( res.data.lessons ) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const getAllLessonsInjector = ( dispatch ) => {\n\treturn async () => {\n\t\tawait getAllLessons( dispatch );\n\t};\n};\n\nexport const getTemplateLessons = async ( dispatch ) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/get_template_lessons' );\n\t\tdispatch( retrievedTemplateLessons( res.data.lessons ) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const getTemplateLessonsInjector = ( dispatch ) => {\n\treturn async () => {\n\t\tawait getTemplateLessons( dispatch );\n\t};\n};\n\n\nexport const getRooms = async ( dispatch ) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/get_open_rooms' );\n\t\tdispatch( retrievedRooms( res.data.rooms ) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const getRoomsInjector = ( dispatch ) => {\n\treturn async () => {\n\t\tawait getRooms( dispatch );\n\t};\n};\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React from 'react';\nimport axios from 'axios';\nimport server from 'constants/server';\nimport i18next from 'i18next';\nimport { addNotification, addErrorNotification } from 'actions/notification';\nimport { UPDATED_SETTINGS, GET_SETTINGS_PUBLIC, GET_SETTINGS } from 'constants/action_types.js';\n\n\n// EXPORTS //\n\nexport const getSettings = async ( dispatch ) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/get_settings' );\n\t\tdispatch({\n\t\t\ttype: GET_SETTINGS,\n\t\t\tpayload: res.data\n\t\t});\n\t} catch ( err ) {\n\t\treturn addErrorNotification( dispatch, err );\n\t}\n};\n\nexport const getSettingsInjector = dispatch => {\n\treturn async () => {\n\t\tawait getSettings( dispatch );\n\t};\n};\n\nexport const getPublicSettings = async ( dispatch ) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/get_public_settings' );\n\t\tdispatch({\n\t\t\ttype: GET_SETTINGS_PUBLIC,\n\t\t\tpayload: res.data\n\t\t});\n\t} catch ( err ) {\n\t\treturn addErrorNotification( dispatch, err );\n\t}\n};\n\nexport const getPublicSettingsInjector = dispatch => {\n\treturn async () => {\n\t\tawait getPublicSettings( dispatch );\n\t};\n};\n\nexport const updateSettings = async ( dispatch, name, value ) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/update_settings', {\n\t\t\tname, value\n\t\t});\n\t\taddNotification( dispatch, {\n\t\t\ttitle: i18next.t('common:updated'),\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t\tdispatch({\n\t\t\ttype: UPDATED_SETTINGS,\n\t\t\tpayload: res.data\n\t\t});\n\t} catch ( err ) {\n\t\treturn addErrorNotification( dispatch, err );\n\t}\n};\n\nexport const updateSettingsInjector = dispatch => {\n\treturn async ( name, value ) => {\n\t\tawait updateSettings( dispatch, name, value );\n\t};\n};\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// EXPORTS //\n\nexport const ADD_ENROLLED_NAMESPACE = 'ADD_ENROLLED_NAMESPACE';\nexport const ADD_ERROR_NOTIFICATION = 'ADD_ERROR_NOTIFICATION';\nexport const ADD_NOTIFICATION = 'ADD_NOTIFICATION';\nexport const APPEND_CREATED_NAMESPACE = 'APPEND_CREATED_NAMESPACE';\nexport const AUTHENTICATED = 'AUTHENTICATED';\nexport const CHANGED_NAMESPACE = 'CHANGED_NAMESPACE';\nexport const CREATED_ANNOUNCEMENT = 'CREATED_ANNOUNCEMENT';\nexport const CREATED_CUSTOM_FIELD = 'CREATED_CUSTOM_FIELD';\nexport const CREATED_BACKUP = 'CREATED_BACKUP';\nexport const CREATED_TICKET = 'CREATED_TICKET';\nexport const DELETED_BACKUP = 'DELETED_BACKUP';\nexport const DELETED_CURRENT_NAMESPACE = 'DELETED_CURRENT_NAMESPACE';\nexport const DELETED_CUSTOM_FIELD = 'DELETED_CUSTOM_FIELD';\nexport const DELETED_EVENT = 'DELETED_EVENT';\nexport const DELETED_FILE = 'DELETED_FILE';\nexport const DELETED_LESSON = 'DELETED_LESSON';\nexport const DELETED_TICKET = 'DELETED_TICKET';\nexport const DELETED_USER = 'DELETED_USER';\nexport const DELETED_ANNOUNCEMENT = 'DELETED_ANNOUNCEMENT';\nexport const DISABLED_TFA = 'DISABLED_TFA';\nexport const EDITED_ANNOUNCEMENT = 'EDITED_ANNOUNCEMENT';\nexport const ENABLED_TFA = 'ENABLED_TFA';\nexport const FIELD_POSITION_DECREMENTED = 'FIELD_POSITION_DECREMENTED';\nexport const FIELD_POSITION_INCREMENTED = 'FIELD_POSITION_INCREMENTED';\nexport const GET_ALL_COHORTS = 'GET_ALL_COHORTS';\nexport const GET_ALL_FILES = 'GET_ALL_FILES';\nexport const GET_ALL_LESSONS = 'GET_ALL_LESSONS';\nexport const GET_ALL_NAMESPACES = 'GET_ALL_NAMESPACES';\nexport const GET_BACKUPS = 'GET_BACKUPS';\nexport const GET_EVENTS = 'GET_EVENTS';\nexport const GET_ALL_TICKETS = 'GET_ALL_TICKETS';\nexport const GET_COURSE_TICKETS = 'GET_COURSE_TICKETS';\nexport const GET_CUSTOM_FIELDS = 'GET_CUSTOM_FIELDS';\nexport const GET_OVERVIEW_STATISTICS = 'GET_OVERVIEW_STATISTICS';\nexport const GET_HISTORICAL_OVERVIEW_STATISTICS = 'GET_HISTORICAL_OVERVIEW_STATISTICS';\nexport const GET_REQUEST_STATISTICS = 'GET_REQUEST_STATISTICS';\nexport const GET_ROOMS = 'GET_ROOMS';\nexport const GET_SETTINGS = 'GET_SETTINGS';\nexport const GET_SETTINGS_PUBLIC = 'GET_SETTINGS_PUBLIC';\nexport const GET_TEMPLATE_LESSONS = 'GET_TEMPLATE_LESSONS';\nexport const GET_TFA_QRCODE = 'GET_TFA_QRCODE';\nexport const GET_USERS = 'GET_USERS';\nexport const GET_USER_TICKETS = 'GET_USER_TICKETS';\nexport const LESSON_ORDER = 'LESSON_ORDER';\nexport const LESSON_ORDER_DIRECTION = 'LESSON_ORDER_DIRECTION';\nexport const RECEIVED_FILES = 'RECEIVED_FILES';\nexport const RECEIVED_LICENSE = 'RECEIVED_LICENSE';\nexport const RECEIVED_NAMESPACE_FILES = 'RECEIVED_NAMESPACE_FILES';\nexport const RECEIVED_TOKEN = 'RECEIVED_TOKEN';\nexport const REMOVED_LICENSE = 'REMOVED_LICENSE';\nexport const REQUEST_TFA = 'REQUEST_TFA';\nexport const RETRIEVED_BADGES = 'RETRIEVED_BADGES';\nexport const RETRIEVED_COHORTS = 'RETRIEVED_COHORTS';\nexport const RETRIEVED_LESSONS = 'RETRIEVED_LESSONS';\nexport const RETRIEVED_PUBLIC_LESSONS = 'RETRIEVED_PUBLIC_LESSONS';\nexport const SEARCH_PHRASE_SET = 'SEARCH_PHRASE_SET';\nexport const TICKET_CLOSED = 'TICKET_CLOSED';\nexport const TICKET_OPENED = 'TICKET_OPENED';\nexport const TICKET_MESSAGE_ADDED = 'TICKET_MESSAGE_ADDED';\nexport const TICKET_PRIORITY_UPDATED = 'TICKET_PRIORITY_UPDATED';\nexport const TRIGGERED_EVENT = 'TRIGGERED_EVENT';\nexport const UPDATED_LESSON = 'UPDATED_LESSON';\nexport const UPDATED_OWNED_NAMESPACE = 'UPDATED_OWNED_NAMESPACE';\nexport const LOGGED_IN = 'LOGGED_IN';\nexport const LOGGED_OUT = 'LOGGED_OUT';\nexport const USER_UPDATED = 'USER_UPDATED';\nexport const USER_UPDATED_BY_ADMIN = 'USER_UPDATED_BY_ADMIN';\nexport const USER_PICTURE_MODIFIED = 'USER_PICTURE_MODIFIED';\nexport const USER_RECEIVED_BADGES = 'USER_RECEIVED_BADGES';\nexport const UPDATED_CUSTOM_FIELD = 'UPDATED_CUSTOM_FIELD';\nexport const UPDATED_SETTINGS = 'UPDATED_SETTINGS';\nexport const UPDATED_STUDENT_PROGRESS = 'UPDATED_STUDENT_PROGRESS';\nexport const RETRIEVED_ENROLLABLE_COHORTS = 'RETRIEVED_ENROLLABLE_COHORTS';\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport { ADD_NOTIFICATION, ADD_ERROR_NOTIFICATION } from 'constants/action_types.js';\n\n\n// EXPORTS //\n\nexport function addNotification( dispatch, notification ) {\n\tdispatch({\n\t\ttype: ADD_NOTIFICATION,\n\t\tpayload: notification\n\t});\n}\n\nexport const addNotificationInjector = dispatch => {\n\treturn notification => {\n\t\taddNotification( dispatch, notification );\n\t};\n};\n\nexport function addErrorNotification( dispatch, err ) {\n\tlet msg;\n\tif ( err.response ) {\n\t\tmsg = 'Server response: ' + err.response.status + '.\\n';\n\t\tmsg += err.response.data;\n\t} else {\n\t\tmsg = err.message;\n\t}\n\tdispatch({\n\t\ttype: ADD_ERROR_NOTIFICATION,\n\t\tpayload: msg\n\t});\n}\n\nexport const addErrorNotificationInjector = dispatch => {\n\treturn message => {\n\t\taddErrorNotification( dispatch, message );\n\t};\n};\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport objectKeys from '@stdlib/utils/keys';\nimport * as types from 'constants/action_types.js';\n\n\n// VARIABLES //\n\nconst initialState = {\n\tcohorts: [],\n\tevents: [],\n\tfiles: [],\n\tlessons: [],\n\tlessonsMap: {},\n\tnamespaces: [],\n\trooms: [],\n\ttickets: [],\n\tusers: [],\n\tstatistics: {},\n\trequestStatistics: [],\n\thistoricalStatistics: [],\n\tbackups: [],\n\tlicense: null,\n\tsettings: {}\n};\n\n\n// EXPORTS //\n\nexport default function admin( state = initialState, action ) {\n\tswitch ( action.type ) {\n\tcase types.GET_USERS: {\n\t\tlet users = action.payload.users;\n\t\tusers = users.map( x => {\n\t\t\tconst keys = objectKeys( x.lessonData );\n\t\t\tlet chatMessages = 0;\n\t\t\tlet nActions = 0;\n\t\t\tfor ( let i = 0; i < keys.length; i++ ) {\n\t\t\t\tconst key = keys[ i ];\n\t\t\t\tchatMessages += x.lessonData[ key ].chatMessages;\n\t\t\t\tconst types = objectKeys( x.lessonData[ key ].actionTypes );\n\t\t\t\tfor ( let j = 0; j < types.length; j++ ) {\n\t\t\t\t\tnActions += x.lessonData[ key ].actionTypes[ types[ j ] ];\n\t\t\t\t}\n\t\t\t}\n\t\t\tx.nActions = nActions;\n\t\t\tx.chatMessages = chatMessages;\n\t\t\tx.createdAt = new Date( x.createdAt );\n\t\t\tx.updatedAt = new Date( x.updatedAt );\n\t\t\treturn x;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\tusers\n\t\t});\n\t}\n\tcase types.GET_ALL_COHORTS: {\n\t\tlet cohorts = action.payload.cohorts;\n\t\tcohorts = cohorts.map( x => {\n\t\t\tx.startDate = new Date( x.startDate );\n\t\t\tx.endDate = new Date( x.endDate );\n\t\t\treturn x;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\tcohorts\n\t\t});\n\t}\n\tcase types.GET_ALL_FILES: {\n\t\tlet files = action.payload.files;\n\t\tfiles = files.map( x => {\n\t\t\tx.updatedAt = new Date( x.updatedAt );\n\t\t\treturn x;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\tfiles\n\t\t});\n\t}\n\tcase types.DELETED_FILE: {\n\t\tlet files = state.files.slice();\n\t\tfiles = files.filter( x => x._id !== action.payload.id );\n\t\treturn Object.assign({}, state, {\n\t\t\tfiles\n\t\t});\n\t}\n\tcase types.GET_ALL_LESSONS: {\n\t\tlet lessons = action.payload.lessons;\n\t\tconst lessonsMap = { ...state.lessonsMap };\n\t\tlessons = lessons.map( x => {\n\t\t\tx.createdAt = new Date( x.createdAt );\n\t\t\tx.updatedAt = new Date( x.updatedAt );\n\t\t\tlessonsMap[ x._id ] = x.title;\n\t\t\treturn x;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\tlessons,\n\t\t\tlessonsMap\n\t\t});\n\t}\n\tcase types.GET_ALL_NAMESPACES: {\n\t\tlet namespaces = action.payload.namespaces;\n\t\tnamespaces = namespaces.map( x => {\n\t\t\tx.createdAt = new Date( x.createdAt );\n\t\t\tx.updatedAt = new Date( x.updatedAt );\n\t\t\treturn x;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\tnamespaces\n\t\t});\n\t}\n\tcase types.GET_EVENTS: {\n\t\tlet events = action.payload.events;\n\t\tevents = events.map( x => {\n\t\t\tx.time = new Date( x.time );\n\t\t\treturn x;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\tevents\n\t\t});\n\t}\n\tcase types.GET_ROOMS: {\n\t\tlet rooms = action.payload.rooms;\n\t\trooms = rooms.map( x => {\n\t\t\tx.startTime = new Date( x.startTime );\n\t\t\treturn x;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\trooms\n\t\t});\n\t}\n\tcase types.DELETED_EVENT: {\n\t\tlet events = state.events.slice();\n\t\tevents = events.filter( x => x._id !== action.payload.id );\n\t\treturn Object.assign({}, state, {\n\t\t\tevents\n\t\t});\n\t}\n\tcase types.DELETED_USER: {\n\t\tlet users = state.users.slice();\n\t\tusers = users.filter( x => x._id !== action.payload.id );\n\t\treturn Object.assign({}, state, {\n\t\t\tusers\n\t\t});\n\t}\n\tcase types.TRIGGERED_EVENT: {\n\t\tconst events = state.events.slice();\n\t\tfor ( let i = 0; i < events.length; i++ ) {\n\t\t\tif ( events[ i ]._id === action.payload.id ) {\n\t\t\t\tevents[ i ].done = true;\n\t\t\t}\n\t\t}\n\t\treturn Object.assign({}, state, {\n\t\t\tevents\n\t\t});\n\t}\n\tcase types.USER_UPDATED_BY_ADMIN: {\n\t\tlet users = state.users.slice();\n\t\tfor ( let i = 0; i < users.length; i++ ) {\n\t\t\tconst user = users[ i ];\n\t\t\tif ( user._id === action.payload.id ) {\n\t\t\t\tconst keys = objectKeys( action.payload );\n\t\t\t\tfor ( let j = 0; j < keys.length; j++ ) {\n\t\t\t\t\tconst key = keys[ j ];\n\t\t\t\t\tif ( key !== 'id' ) {\n\t\t\t\t\t\tuser[ key ] = action.payload[ key ];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn Object.assign({}, state, {\n\t\t\tusers\n\t\t});\n\t}\n\tcase types.GET_OVERVIEW_STATISTICS: {\n\t\treturn Object.assign({}, state, {\n\t\t\tstatistics: action.payload.statistics\n\t\t});\n\t}\n\tcase types.GET_ALL_TICKETS: {\n\t\tlet tickets = action.payload.tickets;\n\t\ttickets = tickets.map( x => {\n\t\t\tx.createdAt = new Date( x.createdAt );\n\t\t\tx.updatedAt = new Date( x.updatedAt );\n\t\t\treturn x;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.DELETED_TICKET: {\n\t\tlet tickets = state.tickets.slice();\n\t\ttickets = tickets.filter( x => x._id !== action.payload.id );\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.TICKET_OPENED: {\n\t\tconst tickets = state.tickets.map( ticket => {\n\t\t\tif ( ticket._id === action.payload.id ) {\n\t\t\t\tticket.done = false;\n\t\t\t}\n\t\t\treturn ticket;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.TICKET_PRIORITY_UPDATED: {\n\t\tconst tickets = state.tickets.map( ticket => {\n\t\t\tif ( ticket._id === action.payload.id ) {\n\t\t\t\tticket.priority = action.payload.priority;\n\t\t\t}\n\t\t\treturn ticket;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.TICKET_CLOSED: {\n\t\tconst tickets = state.tickets.map( ticket => {\n\t\t\tif ( ticket._id === action.payload.id ) {\n\t\t\t\tticket.done = true;\n\t\t\t}\n\t\t\treturn ticket;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.TICKET_MESSAGE_ADDED: {\n\t\tconst tickets = state.tickets.map( ticket => {\n\t\t\tif ( ticket._id === action.payload.id ) {\n\t\t\t\tconst message = action.payload.message;\n\t\t\t\tmessage.picture = message.picture.substring( message.picture.lastIndexOf( '/' )+1 );\n\t\t\t\tticket.messages.unshift( message );\n\t\t\t}\n\t\t\treturn ticket;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.RECEIVED_LICENSE:\n\t\treturn Object.assign({}, state, {\n\t\t\tlicense: action.payload.license\n\t\t});\n\tcase types.REMOVED_LICENSE:\n\t\treturn Object.assign({}, state, {\n\t\t\tlicense: null\n\t\t});\n\tcase types.GET_HISTORICAL_OVERVIEW_STATISTICS: {\n\t\tconst statistics = action.payload.statistics.map( x => {\n\t\t\tx.createdAt = x.createdAt.substring( 0, x.createdAt.indexOf( 'T' ) );\n\t\t\treturn x;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\thistoricalStatistics: statistics\n\t\t});\n\t}\n\tcase types.GET_REQUEST_STATISTICS: {\n\t\treturn Object.assign({}, state, {\n\t\t\trequestStatistics: action.payload.statistics\n\t\t});\n\t}\n\tcase types.GET_BACKUPS: {\n\t\treturn Object.assign({}, state, {\n\t\t\tbackups: action.payload.backups\n\t\t});\n\t}\n\tcase types.CREATED_BACKUP: {\n\t\tconst backups = state.backups.slice();\n\t\tbackups.push( action.payload.backup );\n\t\treturn Object.assign({}, state, {\n\t\t\tbackups\n\t\t});\n\t}\n\tcase types.DELETED_BACKUP: {\n\t\tlet backups = state.backups.slice();\n\t\tbackups = backups.filter( x => x._id !== action.payload.id );\n\t\treturn Object.assign({}, state, {\n\t\t\tbackups\n\t\t});\n\t}\n\tcase types.GET_SETTINGS: {\n\t\treturn Object.assign({}, state, {\n\t\t\tsettings: action.payload\n\t\t});\n\t}\n\tcase types.UPDATED_SETTINGS: {\n\t\treturn Object.assign({}, state, {\n\t\t\tsettings: action.payload.settings\n\t\t});\n\t}\n\tdefault:\n\t\treturn state;\n\t}\n}\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport * as types from 'constants/action_types.js';\n\n\n// EXPORTS //\n\nexport default function badges( state = null, action ) {\n\tswitch ( action.type ) {\n\tcase types.RETRIEVED_BADGES: {\n\t\treturn action.payload.badges;\n\t}\n\tdefault:\n\t\treturn state;\n\t}\n}\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport * as types from 'constants/action_types.js';\nimport isArray from '@stdlib/assert/is-array';\nimport isRegExpString from '@stdlib/assert/is-regexp-string';\nimport reFromString from '@stdlib/utils/regexp-from-string';\nimport contains from '@stdlib/assert/contains';\n\n\n// FUNCTIONS //\n\nfunction titleCompare( a, b ) {\n\treturn ( '' + a.title ).localeCompare( b.title );\n}\n\n\n// EXPORTS //\n\nexport default function cohorts( state = null, action ) {\n\tswitch ( action.type ) {\n\tcase types.RETRIEVED_ENROLLABLE_COHORTS: {\n\t\tlet cohorts = action.payload.cohorts;\n\t\tif ( !isArray( cohorts ) ) {\n\t\t\treturn cohorts;\n\t\t}\n\t\tcohorts = cohorts.filter( elem => {\n\t\t\tlet emailFilter = elem.emailFilter || '';\n\t\t\tif ( isRegExpString( emailFilter ) ) {\n\t\t\t\temailFilter = reFromString( emailFilter );\n\t\t\t\treturn emailFilter.test( action.payload.user.email );\n\t\t\t}\n\t\t\treturn contains( action.payload.user.email, emailFilter || '' );\n\t\t});\n\t\treturn cohorts.sort( titleCompare );\n\t}\n\tdefault:\n\t\treturn state;\n\t}\n}\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport hasOwnProp from '@stdlib/assert/has-own-property';\nimport * as types from 'constants/action_types.js';\n\n\n// FUNCTIONS //\n\nfunction titleCompare( a, b ) {\n\treturn ( '' + a.title ).localeCompare( b.title );\n}\n\n\n// VARIABLES //\n\nconst initialState = {\n\t_id: null,\n\ttitle: '',\n\tdescription: '',\n\towners: '',\n\tenableTicketing: false,\n\tannouncements: [],\n\tlessons: [],\n\tcohorts: [],\n\tfiles: [],\n\townerFiles: [],\n\ttickets: []\n};\n\n\n// EXPORTS //\n\nexport default function namespace( state = initialState, action ) {\n\tswitch ( action.type ) {\n\tcase types.CHANGED_NAMESPACE: {\n\t\treturn Object.assign({}, state, {\n\t\t\t_id: action.payload._id,\n\t\t\ttitle: action.payload.title,\n\t\t\tdescription: action.payload.description,\n\t\t\tannouncements: action.payload.announcements,\n\t\t\tenableTicketing: action.payload.enableTicketing,\n\t\t\towners: action.payload.owners,\n\t\t\tcohorts: action.payload.cohorts\n\t\t});\n\t}\n\tcase types.DELETED_CURRENT_NAMESPACE: {\n\t\treturn initialState;\n\t}\n\tcase types.UPDATED_STUDENT_PROGRESS: {\n\t\tconst { cohort, email, lessonID, progress } = action.payload;\n\t\tconst cohorts = state.cohorts;\n\t\tfor ( let i = 0; i < cohorts.length; i++ ) {\n\t\t\tif ( cohorts[ i ].title === cohort ) {\n\t\t\t\tconst members = cohorts[ i ].members;\n\t\t\t\tfor ( let j = 0; j < members.length; j++ ) {\n\t\t\t\t\tif ( members[ j ].email === email ) {\n\t\t\t\t\t\tconst member = members[ j ];\n\t\t\t\t\t\tmember.lessonData[ lessonID ].progress = progress / 100;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn Object.assign({}, state, { cohorts });\n\t}\n\tcase types.RETRIEVED_LESSONS: {\n\t\tif ( action.payload.namespaceName === state.title ) {\n\t\t\treturn Object.assign({}, state, {\n\t\t\t\tlessons: action.payload.lessons\n\t\t\t});\n\t\t}\n\t\treturn state;\n\t}\n\tcase types.RETRIEVED_COHORTS: {\n\t\treturn Object.assign({}, state, {\n\t\t\tcohorts: action.payload.cohorts.sort( titleCompare )\n\t\t});\n\t}\n\tcase types.DELETED_LESSON: {\n\t\tlet lessons = state.lessons.slice();\n\t\tlessons = lessons.filter( x => x.title !== action.payload.lessonName );\n\t\treturn Object.assign({}, state, {\n\t\t\tlessons\n\t\t});\n\t}\n\tcase types.UPDATED_LESSON: {\n\t\tlet lessons = state.lessons.slice();\n\t\tconst { props, lessonName } = action.payload;\n\t\tfor ( let i = 0; i < lessons.length; i++ ) {\n\t\t\tif ( lessons[ i ].title === lessonName ) {\n\t\t\t\tfor ( let key in props ) {\n\t\t\t\t\tif ( hasOwnProp( props, key ) ) {\n\t\t\t\t\t\tlessons[ i ][ key ] = props[ key ];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn Object.assign({}, state, {\n\t\t\tlessons\n\t\t});\n\t}\n\tcase types.RECEIVED_NAMESPACE_FILES: {\n\t\tlet lessons = state.lessons;\n\t\tlet files = action.payload.files;\n\t\tfiles = files.map( file => {\n\t\t\tfile.updatedAt = new Date( file.updatedAt );\n\t\t\tfor ( let i = 0; i < lessons.length; i++ ) {\n\t\t\t\tif ( lessons[ i ]._id === file.lesson ) {\n\t\t\t\t\tfile.lesson = lessons[ i ];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn file;\n\t\t});\n\t\tconst newState = {};\n\t\tif ( action.payload.owner ) {\n\t\t\tnewState.ownerFiles = files;\n\t\t} else {\n\t\t\tnewState.files = files;\n\t\t}\n\t\treturn Object.assign({}, state, newState );\n\t}\n\tcase types.EDITED_ANNOUNCEMENT: {\n\t\tconst announcements = state.announcements.slice();\n\t\tfor (let i = 0; i < announcements.length; i++) {\n\t\t\tif (announcements[i].createdAt === action.payload.announcement.createdAt) {\n\t\t\t\tannouncements[i] = action.payload.announcement;\n\t\t\t}\n\t\t}\n\t\treturn Object.assign({}, state, {\n\t\t\tannouncements: announcements\n\t\t});\n\t}\n\tcase types.CREATED_ANNOUNCEMENT: {\n\t\tconst announcements = state.announcements.slice();\n\t\tannouncements.unshift(action.payload.announcement);\n\t\treturn Object.assign({}, state, {\n\t\t\tannouncements: announcements\n\t\t});\n\t}\n\tcase types.DELETED_ANNOUNCEMENT: {\n\t\tconst announcements = state.announcements.slice();\n\t\tannouncements.splice(action.payload.index, 1);\n\n\t\treturn Object.assign({}, state, {\n\t\t\tannouncements: announcements\n\t\t});\n\t}\n\tcase types.GET_COURSE_TICKETS: {\n\t\tlet tickets = action.payload.tickets;\n\t\ttickets = tickets.map( x => {\n\t\t\tx.createdAt = new Date( x.createdAt );\n\t\t\treturn x;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.TICKET_OPENED: {\n\t\tconst tickets = state.tickets.map( ticket => {\n\t\t\tif ( ticket._id === action.payload.id ) {\n\t\t\t\tticket.done = false;\n\t\t\t}\n\t\t\treturn ticket;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.TICKET_CLOSED: {\n\t\tconst tickets = state.tickets.map( ticket => {\n\t\t\tif ( ticket._id === action.payload.id ) {\n\t\t\t\tticket.done = true;\n\t\t\t}\n\t\t\treturn ticket;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.TICKET_PRIORITY_UPDATED: {\n\t\tconst tickets = state.tickets.map( ticket => {\n\t\t\tif ( ticket._id === action.payload.id ) {\n\t\t\t\tticket.priority = action.payload.priority;\n\t\t\t}\n\t\t\treturn ticket;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.TICKET_MESSAGE_ADDED: {\n\t\tconst tickets = state.tickets.map( ticket => {\n\t\t\tif ( ticket._id === action.payload.id ) {\n\t\t\t\tconst message = action.payload.message;\n\t\t\t\tmessage.picture = message.picture.substring( message.picture.lastIndexOf( '/' )+1 );\n\t\t\t\tticket.messages.unshift( message );\n\t\t\t}\n\t\t\treturn ticket;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.LOGGED_OUT: {\n\t\treturn initialState;\n\t}\n\tdefault:\n\t\treturn state;\n\t}\n}\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport * as types from 'constants/action_types.js';\n\n\n// VARIABLES //\n\nconst initialState = {\n\tmessage: '',\n\tlevel: '',\n\tposition: 'tl',\n\tchildren: null,\n\ttime: null,\n\tautoDismiss: 5\n};\n\n\n// EXPORTS //\n\nexport default function namespace( state = initialState, action ) {\n\tswitch ( action.type ) {\n\tcase types.ADD_NOTIFICATION: {\n\t\treturn Object.assign({}, initialState, {\n\t\t\t...action.payload,\n\t\t\ttime: new Date()\n\t\t});\n\t}\n\tcase types.ADD_ERROR_NOTIFICATION: {\n\t\treturn {\n\t\t\ttitle: 'Error encountered',\n\t\t\tmessage: action.payload,\n\t\t\tlevel: 'error',\n\t\t\tposition: 'tl',\n\t\t\tautoDismiss: 5,\n\t\t\ttime: new Date()\n\t\t};\n\t}\n\tdefault:\n\t\treturn state;\n\t}\n}\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport * as types from 'constants/action_types.js';\n\n\n// VARIABLES //\n\nconst initialState = {};\n\n\n// EXPORTS //\n\nexport default function settings( state = initialState, action ) {\n\tswitch ( action.type ) {\n\t\tcase types.GET_SETTINGS_PUBLIC: {\n\t\t\treturn Object.assign({}, state, action.payload );\n\t\t}\n\tdefault:\n\t\treturn state;\n\t}\n}\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport * as types from 'constants/action_types.js';\nimport server from 'constants/server';\n\n\n// VARIABLES //\n\nconst initialState = {\n\tlessons: null\n};\n\n\n// EXPORTS //\n\nexport default function namespace( state = initialState, action ) {\n\tswitch ( action.type ) {\n\tcase types.RETRIEVED_PUBLIC_LESSONS: {\n\t\tlet lessons = action.payload.lessons;\n\t\tlessons = lessons.map( (lesson, index) => {\n\t\t\tlesson.colorIndex = index % 20;\n\t\t\tlesson.url = server+'/'+lesson.namespace+'/'+lesson.title;\n\t\t\tif ( !lesson.createdAt ) {\n\t\t\t\tlesson.createdAt = new Date( 0 ).toLocaleString();\n\t\t\t}\n\t\t\tif ( !lesson.updatedAt ) {\n\t\t\t\tlesson.updatedAt = lesson.createdAt;\n\t\t\t}\n\t\t\treturn lesson;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\tlessons\n\t\t});\n\t}\n\tdefault:\n\t\treturn state;\n\t}\n}\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport { LOCATION_CHANGE } from 'connected-react-router';\nimport lowercase from '@stdlib/string/lowercase';\nimport * as types from 'constants/action_types.js';\n\n\n// VARIABLES //\n\nconst initialState = {\n\tphrase: null,\n\ttype: 'sequentially',\n\tdirection: 'ascending'\n};\n\n\n// EXPORTS //\n\nexport default function search( state = initialState, action ) {\n\tswitch ( action.type ) {\n\tcase types.SEARCH_PHRASE_SET: {\n\t\treturn Object.assign({}, state, {\n\t\t\tphrase: lowercase( action.payload.phrase )\n\t\t});\n\t}\n\tcase types.LESSON_ORDER: {\n\t\treturn Object.assign({}, state, {\n\t\t\ttype: action.payload.type\n\t\t});\n\t}\n\tcase types.LESSON_ORDER_DIRECTION: {\n\t\treturn Object.assign({}, state, {\n\t\t\tdirection: action.payload.direction\n\t\t});\n\t}\n\tcase types.LOGGED_OUT: {\n\t\treturn initialState;\n\t}\n\tcase LOCATION_CHANGE: {\n\t\treturn initialState;\n\t}\n\tdefault:\n\t\treturn state;\n\t}\n}\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport groupBy from '@stdlib/utils/group-by';\nimport copy from '@stdlib/utils/copy';\nimport * as types from 'constants/action_types.js';\n\n\n// VARIABLES //\n\nconst initialState = {\n\tloggedIn: false,\n\temail: '',\n\tverifiedEmail: false,\n\tname: '',\n\torganization: '',\n\twriteAccess: false,\n\tadministrator: false,\n\tenrolledNamespaces: [],\n\townedNamespaces: [],\n\tlessonData: {},\n\tpicture: null,\n\tcreatedAt: null,\n\tupdatedAt: null,\n\tscore: null,\n\tspentTime: null,\n\tfiles: null,\n\tbadges: null,\n\tid: null,\n\ttoken: null,\n\ttickets: [],\n\tlicensed: false,\n\tcustomFields: null,\n\tavailableCustomFields: [],\n\ttwoFactorAuth: false,\n\trequestTFA: null,\n\ttemplateLessons: []\n};\n\n\n// FUNCTIONS //\n\nfunction getNamespace( namespaces, name ) {\n\tfor ( let i= 0; i < namespaces.length; i++ ) {\n\t\tif ( namespaces[i].title === name ) {\n\t\t\treturn namespaces[i];\n\t\t}\n\t}\n\treturn null;\n}\n\n\n// EXPORTS //\n\nexport default function user( state = initialState, action ) {\n\tswitch ( action.type ) {\n\tcase types.RECEIVED_TOKEN: {\n\t\treturn Object.assign({}, state, {\n\t\t\ttoken: action.payload.token,\n\t\t\tid: action.payload.id\n\t\t});\n\t}\n\tcase types.LOGGED_IN: {\n\t\treturn Object.assign({}, state, {\n\t\t\temail: action.payload.email,\n\t\t\tverifiedEmail: action.payload.verifiedEmail,\n\t\t\tname: action.payload.name,\n\t\t\tenrolledNamespaces: action.payload.enrolledNamespaces,\n\t\t\townedNamespaces: action.payload.ownedNamespaces,\n\t\t\torganization: action.payload.organization,\n\t\t\twriteAccess: action.payload.writeAccess,\n\t\t\tadministrator: action.payload.administrator,\n\t\t\tpicture: action.payload.picture,\n\t\t\tlessonData: action.payload.lessonData,\n\t\t\tcreatedAt: action.payload.createdAt,\n\t\t\tupdatedAt: action.payload.updatedAt,\n\t\t\tscore: action.payload.score,\n\t\t\tspentTime: action.payload.spentTime,\n\t\t\tlicensed: action.payload.licensed,\n\t\t\tcustomFields: action.payload.customFields,\n\t\t\tavailableCustomFields: action.payload.availableCustomFields,\n\t\t\ttwoFactorAuth: action.payload.twoFactorAuth,\n\t\t\tloggedIn: true\n\t\t});\n\t}\n\tcase types.AUTHENTICATED: {\n\t\treturn Object.assign({}, state, {\n\t\t\twriteAccess: true\n\t\t});\n\t}\n\tcase types.LOGGED_OUT: {\n\t\treturn initialState;\n\t}\n\tcase types.USER_UPDATED: {\n\t\treturn Object.assign({}, state, {\n\t\t\tname: action.payload.name,\n\t\t\torganization: action.payload.organization,\n\t\t\tcustomFields: action.payload.customFields\n\t\t});\n\t}\n\tcase types.USER_PICTURE_MODIFIED: {\n\t\treturn Object.assign({}, state, {\n\t\t\tpicture: action.payload.picture\n\t\t});\n\t}\n\tcase types.APPEND_CREATED_NAMESPACE: {\n\t\tconst arr = state.ownedNamespaces.slice();\n\t\tarr.push( action.payload.namespace );\n\t\treturn Object.assign({}, state, {\n\t\t\townedNamespaces: arr\n\t\t});\n\t}\n\tcase types.DELETED_CURRENT_NAMESPACE: {\n\t\tconst arr = [];\n\t\tfor ( let i = 0; i < state.ownedNamespaces.length; i++ ) {\n\t\t\tconst item = state.ownedNamespaces[ i ];\n\t\t\tif ( item._id !== action.payload.id ) {\n\t\t\t\tarr.push( item );\n\t\t\t}\n\t\t}\n\t\treturn Object.assign({}, state, {\n\t\t\townedNamespaces: arr\n\t\t});\n\t}\n\tcase types.RETRIEVED_LESSONS: {\n\t\tconst arr = state.enrolledNamespaces.slice();\n\t\tfor ( let i = 0; i < arr.length; i++ ) {\n\t\t\tconst course = arr[ i ];\n\t\t\tif ( course.title === action.payload.namespaceName ) {\n\t\t\t\tarr[ i ].lessons = action.payload.lessons;\n\t\t\t}\n\t\t}\n\t\treturn Object.assign({}, state, {\n\t\t\tenrolledNamespaces: arr\n\t\t});\n\t}\n\tcase types.UPDATED_OWNED_NAMESPACE: {\n\t\tconst arr = state.ownedNamespaces.slice();\n\t\tfor ( let i = 0; i < arr.length; i++ ) {\n\t\t\tconst item = arr[ i ];\n\t\t\tif ( item._id === action.payload._id ) {\n\t\t\t\tarr[ i ] = action.payload;\n\t\t\t} else {\n\t\t\t\tarr[ i ] = item;\n\t\t\t}\n\t\t}\n\t\treturn Object.assign({}, state, {\n\t\t\townedNamespaces: arr\n\t\t});\n\t}\n\tcase types.ADD_ENROLLED_NAMESPACE: {\n\t\tconst arr = state.enrolledNamespaces.slice();\n\t\tarr.push( action.payload );\n\t\treturn Object.assign({}, state, {\n\t\t\tenrolledNamespaces: arr\n\t\t});\n\t}\n\tcase types.CREATED_ANNOUNCEMENT: {\n\t\tconst namespaceName = action.payload.namespaceName;\n\t\tconst enrolledNamespaces = copy( state.enrolledNamespaces );\n\t\tlet ns = getNamespace( enrolledNamespaces, namespaceName );\n\t\tif ( ns ) {\n\t\t\tns.announcements.unshift( action.payload.announcement );\n\t\t}\n\t\tconst ownedNamespaces = copy( state.ownedNamespaces );\n\t\tns = getNamespace( ownedNamespaces, namespaceName );\n\t\tif ( ns ) {\n\t\t\tns.announcements.unshift( action.payload.announcement );\n\t\t}\n\t\treturn Object.assign({}, state, {\n\t\t\tenrolledNamespaces,\n\t\t\townedNamespaces\n\t\t});\n\t}\n\tcase types.EDITED_ANNOUNCEMENT: {\n\t\tconst namespaceName = action.payload.namespaceName;\n\t\tconst announcement = action.payload.announcement;\n\t\tconst createdAt = announcement.createdAt;\n\t\tconst enrolledNamespaces = copy( state.enrolledNamespaces );\n\t\tlet ns = getNamespace( enrolledNamespaces, namespaceName );\n\t\tif ( ns ) {\n\t\t\tfor ( let i = 0; i < ns.announcements.length; i++ ) {\n\t\t\t\tif ( ns.announcements[ i ].createdAt === createdAt ) {\n\t\t\t\t\tns.announcements[ i ] = announcement;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst ownedNamespaces = copy( state.ownedNamespaces );\n\t\tns = getNamespace( ownedNamespaces, namespaceName );\n\t\tif ( ns ) {\n\t\t\tfor ( let i = 0; i < ns.announcements.length; i++ ) {\n\t\t\t\tif ( ns.announcements[ i ].createdAt === createdAt ) {\n\t\t\t\t\tns.announcements[ i ] = announcement;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn Object.assign({}, state, {\n\t\t\tenrolledNamespaces,\n\t\t\townedNamespaces\n\t\t});\n\t}\n\tcase types.DELETED_ANNOUNCEMENT: {\n\t\tconst namespaceName = action.payload.namespaceName;\n\t\tconst enrolledNamespaces = copy( state.enrolledNamespaces );\n\t\tlet ns = getNamespace( enrolledNamespaces, namespaceName );\n\t\tif ( ns ) {\n\t\t\tns.announcements.splice( action.payload.index, 1 );\n\t\t}\n\t\tconst ownedNamespaces = copy( state.ownedNamespaces );\n\t\tns = getNamespace( ownedNamespaces, namespaceName );\n\t\tif ( ns ) {\n\t\t\tns.announcements.splice( action.payload.index, 1 );\n\t\t}\n\t\treturn Object.assign({}, state, {\n\t\t\tenrolledNamespaces,\n\t\t\townedNamespaces\n\t\t});\n\t}\n\tcase types.RECEIVED_FILES: {\n\t\treturn Object.assign({}, state, {\n\t\t\tfiles: groupBy( action.payload.files, ( v ) => {\n\t\t\t\treturn v.namespace;\n\t\t\t})\n\t\t});\n\t}\n\tcase types.GET_USER_TICKETS: {\n\t\tlet tickets = action.payload.tickets;\n\t\ttickets = tickets.map( x => {\n\t\t\tx.createdAt = new Date( x.createdAt );\n\t\t\treturn x;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.CREATED_TICKET: {\n\t\tconst tickets = state.tickets.slice();\n\t\ttickets.push({\n\t\t\t...action.payload,\n\t\t\tmessages: [],\n\t\t\tuser: {\n\t\t\t\tpicture: state.picture.substring( state.picture.lastIndexOf( '/' )+1 ),\n\t\t\t\tname: state.name,\n\t\t\t\temail: state.email\n\t\t\t}\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.TICKET_OPENED: {\n\t\tconst tickets = state.tickets.map( ticket => {\n\t\t\tif ( ticket._id === action.payload.id ) {\n\t\t\t\tticket.done = false;\n\t\t\t}\n\t\t\treturn ticket;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.TICKET_CLOSED: {\n\t\tconst tickets = state.tickets.map( ticket => {\n\t\t\tif ( ticket._id === action.payload.id ) {\n\t\t\t\tticket.done = true;\n\t\t\t}\n\t\t\treturn ticket;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.TICKET_MESSAGE_ADDED: {\n\t\tconst tickets = state.tickets.map( ticket => {\n\t\t\tif ( ticket._id === action.payload.id ) {\n\t\t\t\tconst message = action.payload.message;\n\t\t\t\tmessage.picture = message.picture.substring( message.picture.lastIndexOf( '/' )+1 );\n\t\t\t\tticket.messages.unshift( message );\n\t\t\t}\n\t\t\treturn ticket;\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\ttickets\n\t\t});\n\t}\n\tcase types.USER_RECEIVED_BADGES: {\n\t\treturn Object.assign({}, state, {\n\t\t\tbadges: action.payload.badges\n\t\t});\n\t}\n\tcase types.GET_CUSTOM_FIELDS:\n\tcase types.FIELD_POSITION_DECREMENTED:\n\tcase types.FIELD_POSITION_INCREMENTED: {\n\t\treturn Object.assign({}, state, {\n\t\t\tavailableCustomFields: action.payload.customFields\n\t\t});\n\t}\n\tcase types.DELETED_CUSTOM_FIELD: {\n\t\tconst fields = [];\n\t\tfor ( let i = 0; i < state.availableCustomFields.length; i++ ) {\n\t\t\tconst item = state.availableCustomFields[ i ];\n\t\t\tif ( item._id !== action.payload.id ) {\n\t\t\t\tfields.push( item );\n\t\t\t}\n\t\t}\n\t\treturn Object.assign({}, state, {\n\t\t\tavailableCustomFields: fields\n\t\t});\n\t}\n\tcase types.CREATED_CUSTOM_FIELD: {\n\t\tconst availableCustomFields = state.availableCustomFields.slice();\n\t\tavailableCustomFields.push({\n\t\t\t...action.payload\n\t\t});\n\t\treturn Object.assign({}, state, {\n\t\t\tavailableCustomFields\n\t\t});\n\t}\n\tcase types.ENABLED_TFA: {\n\t\treturn Object.assign({}, state, {\n\t\t\ttwoFactorAuth: action.payload.verified\n\t\t});\n\t}\n\tcase types.DISABLED_TFA: {\n\t\treturn Object.assign({}, state, {\n\t\t\ttwoFactorAuth: !action.payload.disabled\n\t\t});\n\t}\n\tcase types.REQUEST_TFA: {\n\t\treturn Object.assign({}, state, {\n\t\t\trequestTFA: {\n\t\t\t\temail: action.payload.email,\n\t\t\t\tpassword: action.payload.password\n\t\t\t}\n\t\t});\n\t}\n\tcase types.GET_TEMPLATE_LESSONS: {\n\t\treturn Object.assign({}, state, {\n\t\t\ttemplateLessons: action.payload.templateLessons\n\t\t});\n\t}\n\tdefault:\n\t\treturn state;\n\t}\n}\n\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport { combineReducers } from 'redux';\nimport { connectRouter } from 'connected-react-router';\nimport admin from './admin';\nimport badges from './badges';\nimport cohorts from './cohorts';\nimport namespace from './namespace';\nimport notification from './notification';\nimport settings from './settings';\nimport gallery from './gallery';\nimport search from './search';\nimport user from './user';\n\n\n// EXPORTS //\n\nexport default ( history ) => combineReducers({\n\tadmin,\n\tbadges,\n\tcohorts,\n\tgallery,\n\tnamespace,\n\tnotification,\n\trouter: connectRouter( history ),\n\tsearch,\n\tsettings,\n\tuser\n});\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport NotificationSystem from 'react-notification-system';\n\n\n// VARIABLES //\n\nconst style = {\n\tNotificationItem: {\n\t\tDefaultStyle: {\n\t\t\tmargin: '20px 2px 2px 1px'\n\t\t},\n\t\tinfo: {\n\t\t\tcolor: 'black',\n\t\t\tbackgroundColor: 'white',\n\t\t\tboxShadow: '0 0 4px darkslategray',\n\t\t\theight: '400px',\n\t\t\twidth: '400px',\n\t\t\tborderTop: 'none'\n\t\t}\n\t}\n};\n\n\n// MAIN //\n\nclass NotificationContainer extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t}\n\n\tcomponentDidUpdate( prevProps, prevState ) {\n\t\tconst notification = this.props.notification;\n\t\tconst prevNotification = prevProps.notification;\n\t\tif ( prevNotification.time !== notification.time ) {\n\t\t\tthis.notificationSystem.addNotification( notification );\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<NotificationSystem\n\t\t\t\tstyle={style}\n\t\t\t\tref={( elem ) => {\n\t\t\t\t\tthis.notificationSystem = elem;\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n}\n\nNotificationContainer.propTypes = {\n\tnotification: PropTypes.object.isRequired\n};\n\nfunction mapStateToProps( state ) {\n\treturn {\n\t\tnotification: state.notification\n\t};\n}\n\nexport default connect(\n\tmapStateToProps\n)( NotificationContainer );\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React, { Component, Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport logger from 'debug';\nimport { connect } from 'react-redux';\nimport { Route } from 'react-router-dom';\nimport { ConnectedRouter } from 'connected-react-router';\nimport asyncComponent from 'components/async';\nimport server from 'constants/server';\nimport { fetchCredentialsInjector } from 'actions/authentication.js';\nimport { getEnrollableCohortsInjector } from 'actions/cohort.js';\nimport { getPublicSettingsInjector } from 'actions/settings.js';\nimport NotificationSystem from './notification.js';\nimport './app.css';\n\n\n// VARIABLES //\n\nconst AsyncFooterBar = asyncComponent(() => import( 'containers/visible-footer-bar' ));\nconst AsyncTerms = asyncComponent(() => import( 'containers/visible-terms' ));\nconst AsyncPrivacy = asyncComponent(() => import( 'containers/visible-privacy' ));\nconst AsyncHeaderBar = asyncComponent(() => import( 'containers/visible-header-bar' ));\nconst AsyncForgotPassword = asyncComponent(() => import( 'containers/visible-forgot-password' ));\nconst AsyncCreateNamespace = asyncComponent(() => import( 'containers/visible-create-namespace' ));\nconst AsyncEditNamespace = asyncComponent(() => import( 'containers/visible-edit-namespace' ));\nconst AsyncNewPassword = asyncComponent(() => import( 'components/new-password' ));\nconst AsyncCompleteRegistration = asyncComponent(() => import( 'components/complete-registration' ));\nconst AsyncConfirmEmail = asyncComponent(() => import( 'containers/visible-confirm-email' ));\nconst AsyncShibboleth = asyncComponent(() => import( 'containers/visible-shibboleth' ));\nconst AsyncAdminPage = asyncComponent(() => import( 'containers/visible-admin' ));\nconst AsyncAdminSettings = asyncComponent(() => import( 'containers/visible-admin-settings' ));\nconst AsyncLogin = asyncComponent(() => import( 'containers/visible-login' ));\nconst AsyncLoginTFA = asyncComponent(() => import( 'containers/visible-login-tfa' ));\nconst AsyncSignup = asyncComponent(() => import( 'containers/visible-signup' ));\nconst AsyncNamespaceData = asyncComponent(() => import( 'containers/visible-namespace-data' ));\nconst AsyncGallery = asyncComponent(() => import( 'containers/visible-gallery' ));\nconst AsyncLessonsPage = asyncComponent(() => import( 'containers/visible-lessons-page' ));\nconst AsyncProfilePage = asyncComponent(() => import( 'containers/visible-profile-page' ));\nconst AsyncEnrollPage = asyncComponent(() => import( 'containers/visible-enroll-page' ));\nconst USER_STORAGE_ID = 'ISLE_USER_'+server;\n\n\n// VARIABLES //\n\nconst ALL_LOGGEDIN_PATHS = [\n\t'/create-namespace',\n\t'/edit-namespace/:namespace',\n\t'/edit-namespace',\n\t'/namespace-data/:namespace',\n\t'/profile',\n\t'/lessons/:namespace',\n\t'/lessons',\n\t'/gallery',\n\t'/enroll',\n\t'/admin',\n\t'/admin-settings'\n];\nconst RE_PUBLIC_PAGES = /(?:courses|new-password|complete-registration|confirm-email|shibboleth|signup|login|login-tfa|terms|privacy)/;\nconst debug = logger( 'isle-dashboard' );\n\n\n// MAIN //\n\nclass App extends Component {\n\tasync componentDidMount() {\n\t\tconst history = this.props.history;\n\t\tthis.props.getPublicSettings();\n\t\tif (\n\t\t\t!this.props.isLoggedIn &&\n\t\t\t!RE_PUBLIC_PAGES.test( history.location.pathname )\n\t\t) {\n\t\t\tlet isle = localStorage.getItem( USER_STORAGE_ID );\n\t\t\tif ( isle ) {\n\t\t\t\tisle = JSON.parse( isle );\n\t\t\t\tconst user = await this.props.fetchCredentials( isle );\n\t\t\t\tif ( user ) {\n\t\t\t\t\tthis.props.getEnrollableCohorts( user );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\thistory.replace( '/login' );\n\t\t\t}\n\t\t}\n\t\tif ( this.props.isLoggedIn ) {\n\t\t\tdebug( 'User is logged in, updating local storage...' );\n\t\t\tconst isle = localStorage.getItem( USER_STORAGE_ID );\n\t\t\tif ( !isle ) {\n\t\t\t\tlocalStorage.setItem( USER_STORAGE_ID, JSON.stringify({\n\t\t\t\t\ttoken: this.props.user.token,\n\t\t\t\t\tid: this.props.user.id\n\t\t\t\t}) );\n\t\t\t}\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst history = this.props.history;\n\t\tconst isLoggingOut = prevProps.isLoggedIn && !this.props.isLoggedIn;\n\t\tconst isLoggingIn = !prevProps.isLoggedIn && this.props.isLoggedIn;\n\t\tconst pathname = history.location.pathname;\n\t\tif ( isLoggingIn ) {\n\t\t\tif ( pathname === '/login-tfa' ) {\n\t\t\t\tconst path = this.props.user.writeAccess ? '/lessons' : '/profile';\n\t\t\t\thistory.push( path );\n\t\t\t}\n\t\t\telse if ( pathname && pathname !== '/' && pathname !== '/login' && pathname !== '/shibboleth' ) {\n\t\t\t\tdebug( 'User has logged in, redirecting to: '+pathname );\n\t\t\t\thistory.push( history.location.pathname );\n\t\t\t} else {\n\t\t\t\tconst path = this.props.user.writeAccess ? '/lessons' : '/profile';\n\t\t\t\tdebug( 'User has logged in, redirecting to default page: '+pathname );\n\t\t\t\thistory.push( path );\n\t\t\t}\n\t\t}\n\t\telse if ( isLoggingOut ) {\n\t\t\thistory.push( '/login' );\n\t\t}\n\t\telse if (\n\t\t\tthis.props.isLoggedIn && pathname &&\n\t\t\t( pathname === '/' || pathname === '/login' || pathname === '/login-tfa' || pathname === '/shibboleth' )\n\t\t) {\n\t\t\tconst path = this.props.user.writeAccess ? '/lessons' : '/profile';\n\t\t\thistory.push( path );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst { settings } = this.props;\n\t\tlet AuthenticationBarrier = null;\n\t\tif ( this.props.isLoggedIn ) {\n\t\t\tAuthenticationBarrier =\n\t\t\t\t<Fragment>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath={ALL_LOGGEDIN_PATHS}\n\t\t\t\t\t\tcomponent={AsyncHeaderBar}\n\t\t\t\t\t\thistory={this.props.history}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/create-namespace\"\n\t\t\t\t\t\tcomponent={AsyncCreateNamespace}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/edit-namespace/:namespace\"\n\t\t\t\t\t\tcomponent={AsyncEditNamespace}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/namespace-data/:namespace\" exact\n\t\t\t\t\t\tcomponent={AsyncNamespaceData}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/namespace-data/:namespace/:subpage\"\n\t\t\t\t\t\tcomponent={AsyncNamespaceData}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/profile\"\n\t\t\t\t\t\tcomponent={AsyncProfilePage}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/lessons\" exact\n\t\t\t\t\t\tcomponent={AsyncLessonsPage}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/lessons/:namespace\"\n\t\t\t\t\t\tcomponent={AsyncLessonsPage}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/gallery\"\n\t\t\t\t\t\tcomponent={AsyncGallery}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/enroll\"\n\t\t\t\t\t\tcomponent={AsyncEnrollPage}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/admin\" exact\n\t\t\t\t\t\tcomponent={AsyncAdminPage}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/admin/:subpage\"\n\t\t\t\t\t\tcomponent={AsyncAdminPage}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/admin/settings\" exact\n\t\t\t\t\t\tcomponent={AsyncAdminSettings}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/admin/settings/:subpage\"\n\t\t\t\t\t\tcomponent={AsyncAdminSettings}\n\t\t\t\t\t/>\n\t\t\t\t</Fragment>;\n\t\t}\n\t\treturn (\n\t\t\t<ConnectedRouter history={this.props.history}>\n\t\t\t\t<div className=\"App\">\n\t\t\t\t\t{AuthenticationBarrier}\n\t\t\t\t\t<Route\n\t\t\t\t\t\tpath=\"/*\"\n\t\t\t\t\t\tcomponent={AsyncFooterBar}\n\t\t\t\t\t\thistory={this.props.history}\n\t\t\t\t\t/>\n\t\t\t\t\t<Route exact path=\"/\" component={AsyncLogin} />\n\t\t\t\t\t<Route path=\"/login\" component={AsyncLogin} />\n\t\t\t\t\t<Route path=\"/login-tfa\" component={AsyncLoginTFA} />\n\t\t\t\t\t<Route path=\"/new-password\" component={AsyncNewPassword} />\n\t\t\t\t\t<Route path=\"/complete-registration\" component={AsyncCompleteRegistration} />\n\t\t\t\t\t<Route path=\"/confirm-email\" component={AsyncConfirmEmail} />\n\t\t\t\t\t<Route path=\"/shibboleth\" component={AsyncShibboleth} />\n\t\t\t\t\t{settings.allowUserRegistrations ? <Route path=\"/signup\" component={AsyncSignup} /> : null}\n\t\t\t\t\t<Route path=\"/forgot-password\" component={AsyncForgotPassword} />\n\t\t\t\t\t<Route path=\"/terms\" component={AsyncTerms} />\n\t\t\t\t\t<Route path=\"/privacy\" component={AsyncPrivacy} />\n\t\t\t\t\t<NotificationSystem />\n\t\t\t\t</div>\n\t\t\t</ConnectedRouter>\n\t\t);\n\t}\n}\n\n\n// PROPERTIES //\n\nApp.propTypes = {\n\thistory: PropTypes.object.isRequired,\n\tisLoggedIn: PropTypes.bool.isRequired,\n\tuser: PropTypes.object.isRequired\n};\n\n\n// EXPORTS //\n\nexport default connect( mapStateToProps, mapDispatchToProps )( App );\n\nfunction mapStateToProps( state ) {\n\treturn {\n\t\tisLoggedIn: state.user.loggedIn,\n\t\tuser: state.user,\n\t\tsettings: state.settings\n\t};\n}\n\nfunction mapDispatchToProps( dispatch ) {\n\treturn {\n\t\tfetchCredentials: fetchCredentialsInjector( dispatch ),\n\t\tgetPublicSettings: getPublicSettingsInjector( dispatch ),\n\t\tgetEnrollableCohorts: getEnrollableCohortsInjector( dispatch )\n\t};\n}\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\nimport Backend from 'i18next-http-backend';\n\n\n// MAIN //\n\ni18n.use( Backend )\n\t.use( LanguageDetector )\n\t.use( initReactI18next )\n\t.init({\n\t\tdebug: false,\n\t\tlng: localStorage.getItem( 'i18nextLng' ) || 'en',\n\t\tfallbackLng: 'en',\n\t\tbackend: {\n\t\t\tloadPath: './locales/{{lng}}/{{ns}}.json'\n\t\t},\n\t\treact: {\n\t\t\tuseSuspense: false\n\t\t},\n\t\tinterpolation: {\n\t\t\tescapeValue: false // Not needed for React!\n\t\t}\n\t});\n\n\n// EXPORTS //\n\nexport default i18n;\n","/**\n* MIT License\n*\n* Copyright (c) 2013-present, Facebook, Inc.\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\n/* eslint-disable no-process-env, no-console */\n\nconst isLocalhost = Boolean(\n\twindow.location.hostname === 'localhost' ||\n\t\t// [::1] is the IPv6 localhost address.\n\t\twindow.location.hostname === '[::1]' ||\n\t\t// 127.0.0.0/8 are considered localhost for IPv4.\n\t\twindow.location.hostname.match(\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n\t\t)\n);\n\nexport function register( config ) {\n\tif ( process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator ) {\n\t\t// The URL constructor is available in all browsers that support SW.\n\t\twindow.addEventListener('load', () => {\n\t\t\tconst swUrl = `${window.location.origin}${window.location.pathname}service-worker.js`;\n\t\t\tif ( isLocalhost ) {\n\t\t\t\t// This is running on localhost. Let's check if a service worker still exists or not.\n\t\t\t\tcheckValidServiceWorker( swUrl, config );\n\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the service worker/PWA documentation.\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t'This web app is being served cache-first by a service ' +\n\t\t\t\t\t\t\t'worker. To learn more, visit https://bit.ly/CRA-PWA'\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Is not localhost. Just register service worker\n\t\t\t\tregisterValidSW( swUrl, config );\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction registerValidSW( swUrl, config ) {\n\tnavigator.serviceWorker\n\t\t.register(swUrl)\n\t\t.then(registration => {\n\t\t\tregistration.onupdatefound = () => {\n\t\t\t\tconst installingWorker = registration.installing;\n\t\t\t\tif ( installingWorker === null ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tinstallingWorker.onstatechange = () => {\n\t\t\t\t\tif ( installingWorker.state === 'installed' ) {\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\n\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\t\tAt this point, the updated precached content has been fetched,\n\t\t\t\t\t\t\t\tbut the previous service worker will still serve the older\n\t\t\t\t\t\t\t\tcontent until all client tabs are closed.\n\t\t\t\t\t\t\t*/\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t'New content is available and will be used when all ' +\n\t\t\t\t\t\t\t\t\t'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && config.onUpdate) {\n\t\t\t\t\t\t\t\tconfig.onUpdate(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\t\tAt this point, everything has been precached.\n\t\t\t\t\t\t\t\tIt's the perfect time to display a\n\t\t\t\t\t\t\t\t\"Content is cached for offline use.\" message.\n\t\t\t\t\t\t\t*/\n\t\t\t\t\t\t\tconsole.log('Content is cached for offline use.');\n\t\t\t\t\t\t\t// Execute callback\n\t\t\t\t\t\t\tif (config && config.onSuccess) {\n\t\t\t\t\t\t\t\tconfig.onSuccess(registration);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t})\n\t\t.catch(error => {\n\t\t\tconsole.error( 'Error during service worker registration:', error );\n\t\t});\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n\t// Check if the service worker can be found. If it can't reload the page.\n\tfetch(swUrl, {\n\t\theaders: { 'Service-Worker': 'script' }\n\t})\n\t\t.then(response => {\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\n\t\t\tconst contentType = response.headers.get('content-type');\n\t\t\tif (\n\t\t\t\tresponse.status === 404 ||\n\t\t\t\t(contentType !== null && contentType.indexOf('javascript') === -1)\n\t\t\t) {\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\n\t\t\t\t\tregistration.unregister().then(() => {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Service worker found. Proceed as normal.\n\t\t\t\tregisterValidSW(swUrl, config);\n\t\t\t}\n\t\t})\n\t\t.catch(() => {\n\t\t\tconsole.log(\n\t\t\t\t'No internet connection found. App is running in offline mode.'\n\t\t\t);\n\t\t});\n}\n\nexport function unregister() {\n\tif ( 'serviceWorker' in navigator ) {\n\t\tnavigator.serviceWorker.ready.then(registration => {\n\t\t\tregistration.unregister();\n\t\t});\n\t}\n}\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport 'react-dates/initialize';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport localforage from 'localforage';\nimport { Provider } from 'react-redux';\nimport { persistStore, persistReducer } from 'redux-persist';\nimport { PersistGate } from 'redux-persist/integration/react';\nimport axios from 'axios';\nimport { createHashHistory } from 'history';\nimport { createStore, applyMiddleware } from 'redux';\nimport { routerMiddleware } from 'connected-react-router';\nimport createRootReducer from 'reducers';\nimport App from 'containers/app.js';\nimport i18next from './helpers/i18n';\nimport * as serviceWorker from './service_worker.js';\nimport 'css/animations.css';\nimport 'css/index.css';\n\n\n// VARIABLES //\n\nconst persistConfig = {\n\tkey: 'root',\n\tblacklist: [ 'router', 'license', 'requestTFA' ],\n\tstorage: localforage\n};\nconst history = createHashHistory();\nconst rootReducer = createRootReducer( history );\nconst persistedReducer = persistReducer( persistConfig, rootReducer );\n\n// Apply the middleware to the store:\nconst middleware = routerMiddleware( history );\nconst store = createStore( persistedReducer, applyMiddleware( middleware ) );\nconst persistor = persistStore( store );\n\naxios.interceptors.request.use( ( config ) => {\n\tconfig.headers[ 'Accept-Language' ] = i18next.language;\n\tconst token = store.getState().user.token;\n\tif ( token ) {\n\t\tconfig.headers.Authorization = `JWT ${token}`;\n\t}\n\treturn config;\n});\n\n\n// MAIN //\n\nReactDOM.render(\n\t<Provider store={store}>\n\t\t<PersistGate loading={null} persistor={persistor}>\n\t\t\t<App history={history} />\n\t\t</PersistGate>\n\t</Provider>,\n\tdocument.getElementById( 'root' )\n);\n\nserviceWorker.register();\n","\n/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport { publicUrl } from './../../config/server.json';\n\n\n// VARIABLES //\n\nexport const REMOTE = publicUrl;\nexport const LOCAL = 'http://localhost:17777';\n\n\n// MAIN //\n\nlet server;\nif ( process.env.NODE_ENV === 'development' ) { // eslint-disable-line no-process-env\n\tserver = process.env.REACT_APP_SERVER === 'remote' ? REMOTE : LOCAL; // eslint-disable-line no-process-env\n} else {\n\tserver = window.location.origin;\n}\n\n\n// EXPORTS //\n\nexport default server;\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React from 'react';\nimport axios from 'axios';\nimport qs from 'querystring';\nimport logger from 'debug';\nimport i18next from 'i18next';\nimport server from 'constants/server';\nimport { getLessons } from 'actions/lesson';\nimport { addNotification, addErrorNotification } from 'actions/notification';\nimport { ADD_ENROLLED_NAMESPACE, GET_ALL_COHORTS, RETRIEVED_COHORTS, RETRIEVED_ENROLLABLE_COHORTS } from 'constants/action_types.js';\n\n\n// VARIABLES //\n\nconst debug = logger( 'isle-dashboard:actions:cohorts' );\n\n\n// MAIN //\n\nexport function addEnrolledNamespace({ title, owners, description, _id }) {\n\treturn {\n\t\ttype: ADD_ENROLLED_NAMESPACE,\n\t\tpayload: {\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\towners,\n\t\t\t_id\n\t\t}\n\t};\n}\n\nexport function retrievedEnrollableCohorts( cohorts, user ) {\n\treturn {\n\t\ttype: RETRIEVED_ENROLLABLE_COHORTS,\n\t\tpayload: {\n\t\t\tcohorts,\n\t\t\tuser\n\t\t}\n\t};\n}\n\nexport function retrievedCohorts( cohorts, user ) {\n\treturn {\n\t\ttype: RETRIEVED_COHORTS,\n\t\tpayload: {\n\t\t\tcohorts,\n\t\t\tuser\n\t\t}\n\t};\n}\n\nexport function retrievedAllCohorts( cohorts ) {\n\treturn {\n\t\ttype: GET_ALL_COHORTS,\n\t\tpayload: {\n\t\t\tcohorts\n\t\t}\n\t};\n}\n\n\n// EXPORTS //\n\nexport const getEnrollableCohorts = async ( dispatch, user ) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/get_enrollable_cohorts' );\n\t\tconst cohorts = res.data.cohorts;\n\t\tdebug( 'Retrieved '+cohorts.length+' cohorts...' );\n\t\tdispatch( retrievedEnrollableCohorts( cohorts, user ) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const getEnrollableCohortsInjector = dispatch => {\n\treturn async ( user ) => {\n\t\tawait getEnrollableCohorts( dispatch, user );\n\t};\n};\n\nexport const getCohorts = async ( dispatch, { namespaceID }) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/get_cohorts?'+qs.stringify({ namespaceID }) );\n\t\tdispatch( retrievedCohorts( res.data.cohorts ) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const getCohortsInjector = ( dispatch ) => {\n\treturn async ({ namespaceID, userToken }) => {\n\t\tawait getCohorts( dispatch, { namespaceID, userToken });\n\t};\n};\n\nexport const addUserToCohort = async ( dispatch, cohortID, namespace ) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/add_to_cohort', { cohortID });\n\t\taddNotification( dispatch, {\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t\tdispatch( addEnrolledNamespace( namespace ) );\n\t\tconst namespaceName = namespace.title;\n\t\tgetLessons( dispatch, namespaceName );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const addUserToCohortInjector = ( dispatch ) => {\n\treturn async ( cohortID, namespace ) => {\n\t\tawait addUserToCohort( dispatch, cohortID, namespace );\n\t};\n};\n\nexport const deleteCohort = async ( dispatch, _id, namespaceID ) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/delete_cohort', { _id });\n\t\taddNotification( dispatch, {\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t\tdispatch( retrievedEnrollableCohorts( null ) );\n\t\tif ( namespaceID ) {\n\t\t\tgetCohorts( dispatch, {\n\t\t\t\tnamespaceID\n\t\t\t});\n\t\t}\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const deleteCohortInjector = ( dispatch ) => {\n\treturn async ( _id, namespaceID ) => {\n\t\tawait deleteCohort( dispatch, _id, namespaceID );\n\t};\n};\n\nexport const createCohort = async ( dispatch, cohort, namespaceID ) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/create_cohort', cohort );\n\t\taddNotification( dispatch, {\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t\tdispatch( retrievedEnrollableCohorts( null ) );\n\t\tgetCohorts( dispatch, { namespaceID });\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const createCohortInjector = ( dispatch ) => {\n\treturn async ( cohort, namespaceID ) => {\n\t\tawait createCohort( dispatch, cohort, namespaceID );\n\t};\n};\n\nexport const updateCohort = async ( dispatch, cohort, namespaceID ) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/update_cohort', { cohort });\n\t\tlet msg = res.data.message;\n\t\tlet notification;\n\t\tif ( res.data.newEmails && res.data.newEmails.length > 0 ) {\n\t\t\tnotification = {\n\t\t\t\tchildren: <div>\n\t\t\t\t\t<p>{msg}</p>\n\t\t\t\t\t<p>{i18next.t('common:email-invitations-sent')}</p>\n\t\t\t\t\t<p>{res.data.newEmails.join( '\\n' )}</p>\n\t\t\t\t</div>,\n\t\t\t\tlevel: 'success',\n\t\t\t\tautoDismiss: 0,\n\t\t\t\tdismissible: 'button'\n\t\t\t};\n\t\t}\n\t\telse {\n\t\t\tnotification = {\n\t\t\t\tmessage: msg,\n\t\t\t\tlevel: 'success'\n\t\t\t};\n\t\t}\n\t\taddNotification( dispatch, notification );\n\t\tdispatch( retrievedEnrollableCohorts( null ) );\n\t\tgetCohorts( dispatch, { namespaceID });\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const updateCohortInjector = ( dispatch ) => {\n\treturn async ( cohort, namespaceID ) => {\n\t\tawait updateCohort( dispatch, cohort, namespaceID );\n\t};\n};\n\nexport const getAllCohorts = async ( dispatch ) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/get_all_cohorts' );\n\t\tdispatch( retrievedAllCohorts( res.data.cohorts ) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const getAllCohortsInjector = ( dispatch ) => {\n\treturn async () => {\n\t\tawait getAllCohorts( dispatch );\n\t};\n};\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport axios from 'axios';\nimport logger from 'debug';\nimport server from 'constants/server';\nimport { addErrorNotification } from 'actions/notification.js';\nimport { loggedIn, receivedToken } from 'actions/user';\n\n\n// VARIABLES //\n\nconst debug = logger( 'isle-dashboard:actions:authentication' );\n\n\n// FUNCTIONS //\n\nconst sanitizeUser = ( user ) => {\n\t// Check for duplicated enrolled and owned namespaces:\n\tconst ownedNamespaces = user.ownedNamespaces;\n\tconst newOwnedNamespaces = [];\n\tlet ids = new Set();\n\tfor ( let i = 0; i < ownedNamespaces.length; i++ ) {\n\t\tif ( !ids.has( ownedNamespaces[ i ]._id ) ) {\n\t\t\tids.add( ownedNamespaces[ i ]._id );\n\t\t\tnewOwnedNamespaces.push( ownedNamespaces[ i ] );\n\t\t}\n\t}\n\tconst enrolledNamespaces = user.enrolledNamespaces;\n\tconst newEnrolledNamespaces = [];\n\tids = new Set();\n\tfor ( let i = 0; i < enrolledNamespaces.length; i++ ) {\n\t\tif ( !ids.has( enrolledNamespaces[ i ]._id ) ) {\n\t\t\tids.add( enrolledNamespaces[ i ]._id );\n\t\t\tnewEnrolledNamespaces.push( enrolledNamespaces[ i ] );\n\t\t}\n\t}\n\tconst needsSanitizing = newOwnedNamespaces.length !== ownedNamespaces.length ||\n\t\tnewEnrolledNamespaces.length !== enrolledNamespaces.length;\n\n\tif ( needsSanitizing ) {\n\t\tuser.ownedNamespaces = newOwnedNamespaces;\n\t\tuser.enrolledNamespaces = newEnrolledNamespaces;\n\t}\n\tdebug( 'Does user need sanitizing? '+needsSanitizing );\n\treturn [ user, needsSanitizing ];\n};\n\n\n// MAIN //\n\nexport const sanitizeRequest = ( dispatch, user ) => {\n\ttry {\n\t\treturn axios.post( server+'/sanitize_user', {\n\t\t\tid: user.id\n\t\t});\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t\treturn null;\n\t}\n};\n\nexport const sanitizeRequestInjector = dispatch => {\n\treturn async ( user ) => {\n\t\tconst result = await sanitizeRequest( dispatch, user );\n\t\treturn result;\n\t};\n};\n\nexport const fetchCredentials = async ( dispatch, obj ) => {\n\tdebug( 'Fetch user credentials...' );\n\tlocalStorage.setItem( 'ISLE_USER_'+server, JSON.stringify( obj ) );\n\ttry {\n\t\tconst res = await axios.post( server+'/credentials_dashboard', {\n\t\t\tid: obj.id\n\t\t});\n\t\tlet user = res.data;\n\t\tif ( user.picture ) {\n\t\t\tuser.picture = server + '/avatar/' + user.picture;\n\t\t}\n\t\tuser = {\n\t\t\t...obj,\n\t\t\t...user\n\t\t};\n\t\tlet [ sanitizedUser, needsSanitizing ] = sanitizeUser( user );\n\t\tdispatch( loggedIn( user ) );\n\t\tif ( needsSanitizing ) {\n\t\t\tsanitizeRequest( dispatch, obj );\n\t\t}\n\t\treturn sanitizedUser;\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t\treturn null;\n\t}\n};\n\nexport const fetchCredentialsInjector = dispatch => {\n\treturn async ( obj ) => {\n\t\tconst result = await fetchCredentials( dispatch, obj );\n\t\treturn result;\n\t};\n};\n\nexport const shibboleth = async ( dispatch, { eppn, name, affil, time, salt, token }) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/shibboleth', {\n\t\t\teppn, name, affil, time, salt, token\n\t\t});\n\t\tdispatch( receivedToken( res.data ) );\n\t\treturn res;\n\t}\n\tcatch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const shibbolethInjector = dispatch => {\n\treturn async ({ eppn, name, affil, time, salt, token }) => {\n\t\tconst result = await shibboleth( dispatch, { eppn, name, affil, time, salt, token } );\n\t\treturn result;\n\t};\n};\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport axios from 'axios';\nimport logger from 'debug';\nimport qs from 'querystring';\nimport i18next from 'i18next';\nimport server from 'constants/server';\nimport { fetchCredentials } from 'actions/authentication.js';\nimport { getEnrollableCohorts } from 'actions/cohort.js';\nimport { addNotification, addErrorNotification } from 'actions/notification.js';\nimport { AUTHENTICATED, USER_PICTURE_MODIFIED, DELETED_USER, GET_USERS, LOGGED_IN, LOGGED_OUT, RECEIVED_TOKEN, REQUEST_TFA, USER_UPDATED, USER_UPDATED_BY_ADMIN } from 'constants/action_types.js';\n\n\n// VARIABLES //\n\nconst debug = logger( 'isle-dashboard:actions:user' );\n\n\n// EXPORTS //\n\nexport function loggedIn( user ) {\n\treturn {\n\t\ttype: LOGGED_IN,\n\t\tpayload: {\n\t\t\temail: user.email,\n\t\t\tverifiedEmail: user.verifiedEmail,\n\t\t\tname: user.name,\n\t\t\tenrolledNamespaces: user.enrolledNamespaces,\n\t\t\townedNamespaces: user.ownedNamespaces,\n\t\t\torganization: user.organization,\n\t\t\twriteAccess: user.writeAccess,\n\t\t\tadministrator: user.administrator,\n\t\t\tlessonData: user.lessonData,\n\t\t\tpicture: user.picture,\n\t\t\tcreatedAt: user.createdAt,\n\t\t\tupdatedAt: user.updatedAt,\n\t\t\tscore: user.score,\n\t\t\tspentTime: user.spentTime,\n\t\t\tlicensed: user.licensed,\n\t\t\tcustomFields: user.customFields,\n\t\t\tavailableCustomFields: user.availableCustomFields,\n\t\t\ttwoFactorAuth: user.twoFactorAuth\n\t\t}\n\t};\n}\n\nexport function receivedToken({ token, id }) {\n\treturn {\n\t\ttype: RECEIVED_TOKEN,\n\t\tpayload: {\n\t\t\ttoken,\n\t\t\tid\n\t\t}\n\t};\n}\n\nexport function requestTFA({ email, password }) {\n\treturn {\n\t\ttype: REQUEST_TFA,\n\t\tpayload: {\n\t\t\temail,\n\t\t\tpassword\n\t\t}\n\t};\n}\n\nexport function loggedOut() {\n\treturn {\n\t\ttype: LOGGED_OUT\n\t};\n}\n\nexport function authenticated() {\n\treturn {\n\t\ttype: AUTHENTICATED\n\t};\n}\n\nexport function updateUserPicture( picture ) {\n\treturn {\n\t\ttype: USER_PICTURE_MODIFIED,\n\t\tpayload: {\n\t\t\tpicture\n\t\t}\n\t};\n}\n\nexport const updatedUser = ({ name, organization }) => {\n\treturn {\n\t\ttype: USER_UPDATED,\n\t\tpayload: {\n\t\t\tname,\n\t\t\torganization\n\t\t}\n\t};\n};\n\nexport const updatedUserByAdmin = ( user ) => {\n\treturn {\n\t\ttype: USER_UPDATED_BY_ADMIN,\n\t\tpayload: user\n\t};\n};\n\nexport const getUsers = async ( dispatch ) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/get_users' );\n\t\tdispatch({\n\t\t\ttype: GET_USERS,\n\t\t\tpayload: {\n\t\t\t\tusers: res.data.users\n\t\t\t}\n\t\t});\n\t} catch ( err ) {\n\t\treturn addErrorNotification( dispatch, err );\n\t}\n};\n\nexport const getUsersInjector = dispatch => {\n\treturn async () => {\n\t\tawait getUsers( dispatch );\n\t};\n};\n\nexport const impersonateUser = async ( dispatch, { id, password }) => {\n\tdebug( 'Impersonating user with id '+id );\n\ttry {\n\t\tconst res = await axios.post( server+'/impersonate', { id, password });\n\t\tconst user = await fetchCredentials( dispatch, {\n\t\t\tid: res.data.id\n\t\t});\n\t\tif ( user ) {\n\t\t\tgetEnrollableCohorts( dispatch, user );\n\t\t}\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const impersonateUserInjector = dispatch => {\n\treturn async ({ id, password }) => {\n\t\tawait impersonateUser( dispatch, { id, password } );\n\t};\n};\n\nexport const deleteUser = async ( dispatch, { id }) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/delete_user', { id });\n\t\taddNotification( dispatch, {\n\t\t\ttitle: i18next.t('common:deleted'),\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t\tdispatch({\n\t\t\ttype: DELETED_USER,\n\t\t\tpayload: {\n\t\t\t\tid\n\t\t\t}\n\t\t});\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const deleteUserInjector = dispatch => {\n\treturn async ({ id }) => {\n\t\tawait deleteUser( dispatch, { id } );\n\t};\n};\n\nexport const uploadProfilePic = async ( dispatch, { token, avatarData, thumbnailData }) => {\n\ttry {\n\t\tlet res = await axios.post( server+'/upload_profile_pic', avatarData );\n\t\tconst message = res.data.message;\n\t\tlet filename = res.data.filename;\n\t\tfilename = server + '/avatar/' + filename;\n\t\tdispatch( updateUserPicture( filename ) );\n\n\t\tres = await axios.post( server+'/upload_thumbnail_pic', thumbnailData );\n\t\taddNotification( dispatch, {\n\t\t\ttitle: i18next.t('profile-pic-title'),\n\t\t\tmessage,\n\t\t\tlevel: 'success',\n\t\t\tposition: 'tl'\n\t\t});\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const uploadProfilePicInjector = ( dispatch ) => {\n\treturn async ({ avatarData, thumbnailData }) => {\n\t\tawait uploadProfilePic( dispatch, { avatarData, thumbnailData });\n\t};\n};\n\nexport const authenticate = async ( dispatch, { writeAccessToken }) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/set_write_access', { token: writeAccessToken });\n\t\tdispatch( authenticated() );\n\t\taddNotification( dispatch, {\n\t\t\tmessage: res.data.message+' You can now create your own courses on ISLE and have access to the gallery of public lessons.',\n\t\t\tlevel: 'success',\n\t\t\tautoDismiss: 10\n\t\t});\n\t\treturn true;\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t\treturn false;\n\t}\n};\n\nexport const authenticateInjector = ( dispatch ) => {\n\treturn async ({ writeAccessToken }) => {\n\t\tconst result = await authenticate( dispatch, { writeAccessToken });\n\t\treturn result;\n\t};\n};\n\nexport const forgotPassword = async ( dispatch, { email }) => {\n\ttry {\n\t\tawait axios.get( server+'/forgot_password?'+qs.stringify({ email }) );\n\t\taddNotification( dispatch, {\n\t\t\tmessage: 'Check your email inbox for a link to choose a new password.',\n\t\t\tlevel: 'success'\n\t\t});\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const forgotPasswordInjector = ( dispatch ) => {\n\treturn async ({ email }) => {\n\t\tawait forgotPassword( dispatch, { email });\n\t};\n};\n\nexport const updateUser = async ( dispatch, form ) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/update_user', form );\n\t\tdispatch( updatedUser({\n\t\t\tname: form.name,\n\t\t\torganization: form.organization,\n\t\t\tcustomFields: form.customFields\n\t\t}) );\n\t\taddNotification( dispatch, {\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const updateUserInjector = ( dispatch ) => {\n\treturn async ({ name, organization, password, customFields }) => {\n\t\tawait updateUser( dispatch, { name, organization, password, customFields });\n\t};\n};\n\nexport const createUser = ( form ) => {\n\treturn axios.post( server+'/create_user', form );\n};\n\nexport const handleLogin = async ( dispatch, form ) => {\n\tconst res = await axios.post( server+'/login', form );\n\tif ( res.data.message === 'finish-login-via-tfa' ) {\n\t\tdispatch( requestTFA( res.data ) );\n\t} else {\n\t\tdispatch( receivedToken( res.data ) );\n\t}\n\treturn res;\n};\n\nexport const handleLoginInjector = ( dispatch ) => {\n\treturn async ( form ) => {\n\t\tconst result = await handleLogin( dispatch, form );\n\t\treturn result;\n\t};\n};\n\nexport const handleLoginTFA = async ( dispatch, form ) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/login_tfa', form );\n\t\tdispatch( receivedToken( res.data ) );\n\t\treturn res;\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const handleLoginTFAInjector = ( dispatch ) => {\n\treturn async ( form ) => {\n\t\tconst result = await handleLoginTFA( dispatch, form );\n\t\treturn result;\n\t};\n};\n\nexport const restoreLogin = ( dispatch, user ) => {\n\tdispatch( loggedIn( user ) );\n};\n\nexport const restoreLoginInjector = ( dispatch ) => {\n\treturn ( user ) => {\n\t\trestoreLogin( dispatch, user );\n\t};\n};\n\nexport const logout = ( dispatch ) => {\n\tlocalStorage.removeItem( 'ISLE_USER_'+server );\n\tdispatch( loggedOut() );\n};\n\nexport const logoutInjector = ( dispatch ) => {\n\treturn () => {\n\t\tlogout( dispatch );\n\t};\n};\n\nexport const userUpdateCheck = async ( dispatch, user ) => {\n\ttry {\n\t\tconst res = await axios.get( server+'/user_update_check?'+qs.stringify({\n\t\t\tupdatedAt: user.updatedAt\n\t\t}) );\n\t\tdebug( 'Received response: '+res.data );\n\t\tif ( !res.data.hasMostRecent ) {\n\t\t\tconst res = await axios.post( server+'/credentials_dashboard', {\n\t\t\t\tid: user.id\n\t\t\t});\n\t\t\tlet newUser = res.data;\n\t\t\tif ( newUser.picture ) {\n\t\t\t\tnewUser.picture = server + '/avatar/' + newUser.picture;\n\t\t\t}\n\t\t\tnewUser = {\n\t\t\t\tid: user.id,\n\t\t\t\ttoken: user.token,\n\t\t\t\t...newUser\n\t\t\t};\n\t\t\tdebug( 'Updated user data...' );\n\t\t\tdispatch( loggedIn( newUser ) );\n\t\t}\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const userUpdateCheckInjector = ( dispatch ) => {\n\treturn async ( user ) => {\n\t\tawait userUpdateCheck( dispatch, user );\n\t};\n};\n\nexport const confirmEmail = async ( token ) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/confirm_email', {\n\t\t\ttoken\n\t\t});\n\t\treturn res.data.message;\n\t} catch ( err ) {\n\t\tif ( err.response && err.response.data ) {\n\t\t\treturn err.response.data;\n\t\t}\n\t\treturn err.message;\n\t}\n};\n\nexport const resendConfirmEmail = async ( dispatch, user ) => {\n\ttry {\n\t\tawait axios.post( server+'/resend_confirm_email' );\n\t\taddNotification( dispatch, {\n\t\t\ttitle: 'Email sent',\n\t\t\tmessage: i18next.t('common:verification-email-sent'),\n\t\t\tlevel: 'success',\n\t\t\tposition: 'tl'\n\t\t});\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const resendConfirmEmailInjector = ( dispatch ) => {\n\treturn async ( user ) => {\n\t\tawait resendConfirmEmail( dispatch, user );\n\t};\n};\n\nexport const adminUpdateUser = async ( dispatch, form ) => {\n\ttry {\n\t\tconst res = await axios.post( server+'/admin_update_user', form );\n\t\taddNotification( dispatch, {\n\t\t\tmessage: res.data.message,\n\t\t\tlevel: 'success'\n\t\t});\n\t\tdispatch( updatedUserByAdmin( form ) );\n\t} catch ( err ) {\n\t\taddErrorNotification( dispatch, err );\n\t}\n};\n\nexport const adminUpdateUserInjector = ( dispatch ) => {\n\treturn async ( form ) => {\n\t\tawait adminUpdateUser( dispatch, form );\n\t};\n};\n"],"sourceRoot":""}