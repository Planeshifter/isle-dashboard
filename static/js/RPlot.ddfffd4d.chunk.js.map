{"version":3,"sources":["../node_modules/@isle-project/components/r/utils/create-prepend-code/index.js","../node_modules/@isle-project/components/internal/spinner/index.js","../node_modules/@isle-project/components/image/index.js","../node_modules/@isle-project/components/r/plot/main.js"],"names":["createPrependCode","libs","prependCode","session","rshell","config","libraries","concat","ret","map","x","join","requireLibs","global","isArray","Spinner","props","context","findDOMNode","getContext","start","Date","lines","cW","canvas","width","cH","height","activeSpinner","window","setInterval","num","rotation","parseInt","save","clearRect","translate","rotate","PI","i","beginPath","moveTo","lineTo","lineWidth","strokeStyle","stroke","restore","this","clearInterval","running","startSpinner","style","display","margin","Component","defaultProps","Image","Loadable","addResources","RPlot","error","img","body","onDone","setState","plotURL","plot","waiting","state","last","getPlot","code","fullCode","getRPlot","fileType","savePlot","draggableBar","draggable","className","onDragStart","ev","meta","omitBy","_","value","isNull","jsyaml","dump","id","dataTransfer","setData","t","rest","minHeight","cursor","src","title","contextType","SessionContext","withTranslation"],"mappings":"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","file":"static/js/RPlot.ddfffd4d.chunk.js","sourcesContent":["// MODULES //\n\nimport isArray from '@stdlib/assert/is-array';\n\n\n// FUNCTIONS //\n\nconst requireLibs = ( libs ) => {\n\treturn libs.map( x => 'library(' + x + ');' )\n\t\t.join( ' ' );\n};\n\n\n// MAIN //\n\n/**\n* Create code to be added in front of user-supplied R code.\n*\n* @param {Array} libs - array of libraries to requireLibs\n* @param {(Array|string)} prependCode - array of strings or single string of code to prepend\n* @param {Object} session - session object\n* @param {string} generated code\n*/\nfunction createPrependCode( libs, prependCode, session ) {\n\tconst { rshell } = session.config;\n\tif ( rshell && rshell.libraries ) {\n\t\tlibs = libs.concat( rshell.libraries );\n\t}\n\tlet ret = requireLibs( libs );\n\tif ( rshell && rshell.global ) {\n\t\tret += rshell.global + '\\n';\n\t}\n\tprependCode = isArray( prependCode ) ?\n\t\tprependCode.join( '\\n' ) :\n\t\tprependCode;\n\tprependCode += '\\n';\n\tret += prependCode;\n\treturn ret;\n}\n\n\n// EXPORTS //\n\nexport default createPrependCode;\n","// MODULES //\n\nimport React, { Component } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport PropTypes from 'prop-types';\nimport PI from '@stdlib/constants/math/float64-pi';\n\n\n// MAIN //\n\n/**\n* Spinner to visualize load times.\n*\n* @property {string} display - CSS display property\n* @property {number} height - height (in px)\n* @property {number} width - width (in px)\n* @property {number} lines - number of lines\n* @property {Object} style - CSS inline styles\n*/\nclass Spinner extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t}\n\n\tcomponentDidUpdate() {\n\t\tif ( this.activeSpinner && this.context.canvas ) {\n\t\t\tclearInterval( this.activeSpinner );\n\t\t\tthis.context.clearRect( 0, 0, this.context.canvas.width, this.context.canvas.height );\n\t\t}\n\t\tif ( this.props.running === true ) {\n\t\t\tthis.startSpinner();\n\t\t}\n\t}\n\n\tstartSpinner = () => {\n\t\tconst canvas = findDOMNode( this );\n\t\tconst context = canvas.getContext( '2d' );\n\t\tthis.context = context;\n\t\tconst start = new Date();\n\t\tconst lines = this.props.lines;\n\t\tconst cW = context.canvas.width;\n\t\tconst cH = context.canvas.height;\n\n\t\tconst draw = () => {\n\t\t\tconst num = ( ( new Date() - start ) / 1000 ) * lines;\n\t\t\tconst rotation = parseInt( num, 10 ) / lines;\n\t\t\tcontext.save();\n\t\t\tcontext.clearRect( 0, 0, cW, cH );\n\t\t\tcontext.translate( cW / 2.0, cH / 2.0 );\n\t\t\tcontext.rotate( PI * 2 * rotation );\n\t\t\tfor ( let i = 0; i < lines; i++ ) {\n\t\t\t\tcontext.beginPath();\n\t\t\t\tcontext.rotate( PI * 2.0 / lines );\n\t\t\t\tcontext.moveTo( cW / 10, 0 );\n\t\t\t\tcontext.lineTo( cW / 4, 0 );\n\t\t\t\tcontext.lineWidth = cW / 30;\n\t\t\t\tcontext.strokeStyle = 'rgba(0, 0, 0,' + i / lines + ')';\n\t\t\t\tcontext.stroke();\n\t\t\t}\n\t\t\tcontext.restore();\n\t\t};\n\t\tthis.activeSpinner = window.setInterval( draw, 50 );\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<canvas\n\t\t\t\tstyle={{\n\t\t\t\t\twidth: this.props.width,\n\t\t\t\t\theight: this.props.height,\n\t\t\t\t\tdisplay: this.props.running ? this.props.display : 'none',\n\t\t\t\t\tmargin: 'auto',\n\t\t\t\t\t...this.props.style\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n}\n\n\n// PROPERTIES //\n\nSpinner.defaultProps = {\n\tdisplay: 'block',\n\theight: 64,\n\tlines: 16,\n\tstyle: {},\n\twidth: 128\n};\n\nSpinner.propTypes = {\n\tdisplay: PropTypes.string,\n\theight: PropTypes.number,\n\tlines: PropTypes.number,\n\trunning: PropTypes.bool.isRequired,\n\tstyle: PropTypes.object,\n\twidth: PropTypes.number\n};\n\n\n// EXPORTS //\n\nexport default Spinner;\n","// MODULES //\n\nimport Loadable from '@isle-project/components/internal/loadable';\n\n\n// MAIN //\n\nconst Image = Loadable( () => import( /* webpackChunkName: \"Image\" */ './main.js' ) );\n\n\n// EXPORTS //\n\nexport default Image;\n","// MODULES //\n\nimport React, { Component, Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { withTranslation } from 'react-i18next';\nimport jsyaml from 'js-yaml';\nimport omitBy from '@stdlib/utils/omit-by';\nimport isNull from '@stdlib/assert/is-null';\nimport createPrependCode from '@isle-project/components/r/utils/create-prepend-code';\nimport Spinner from '@isle-project/components/internal/spinner';\nimport Image from '@isle-project/components/image';\nimport SessionContext from '@isle-project/session/context.js';\nimport { addResources } from '@isle-project/locales';\nimport './plot.css';\n\n\n// VARIABLES //\n\naddResources( 'R' );\n\n\n// MAIN //\n\n/**\n* Component for rendering an R plot inside an ISLE lesson.\n*\n* @property {string} code - R code to generate the plot\n* @property {number} width - width of the plot (in px)\n* @property {number} height - height of the plot (in px)\n* @property {boolean} draggable - controls whether the plot should be draggable\n* @property {string} fileType - file type of the plot (`png` or `svg`)\n* @property {Array} libraries - R libraries that should be loaded automatically when the input `code` is executed\n* @property {(string|Array<string>)} prependCode - `string` or an `array` of R code snippets to be prepended to the code stored in `code` when evaluating\n* @property {Object} meta - plot meta-information\n* @property {string} className - class name\n* @property {Function} onDone - callback invoked with `err`, `img` and `body` arguments once a plot is created\n*/\nclass RPlot extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t\tthis.state = {\n\t\t\tplotURL: null,\n\t\t\tplot: null,\n\t\t\tlast: '',\n\t\t\twaiting: false\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.getPlot();\n\t}\n\n\tcomponentDidUpdate() {\n\t\tthis.getPlot();\n\t}\n\n\tsavePlot = ( error, img, body ) => {\n\t\tif ( error ) {\n\t\t\tthis.props.onDone( error );\n\t\t} else {\n\t\t\tthis.setState({\n\t\t\t\tplotURL: img,\n\t\t\t\tplot: body,\n\t\t\t\twaiting: false\n\t\t\t}, () => {\n\t\t\t\tthis.props.onDone( null, img, body );\n\t\t\t});\n\t\t}\n\t}\n\n\tgetPlot() {\n\t\tif ( this.props.code !== this.state.last ) {\n\t\t\tthis.setState({\n\t\t\t\twaiting: true,\n\t\t\t\tlast: this.props.code\n\t\t\t});\n\t\t\tconst session = this.context;\n\t\t\tconst prependCode = createPrependCode( this.props.libraries, this.props.prependCode, session );\n\t\t\tconst fullCode = prependCode + this.props.code;\n\t\t\tsession.getRPlot( fullCode, this.props.fileType, this.savePlot );\n\t\t}\n\t}\n\n\trender() {\n\t\tlet draggableBar = null;\n\t\tif ( this.props.draggable ) {\n\t\t\tdraggableBar = <div\n\t\t\t\tclassName=\"rplot-draggable-bar\"\n\t\t\t\tdraggable={true}\n\t\t\t\tonDragStart={( ev ) => {\n\t\t\t\t\tlet img;\n\t\t\t\t\tif ( !this.props.meta ) {\n\t\t\t\t\t\timg = `<img src=\"${this.state.plot}\" alt=\"R Plot\" style=\"display: block; margin: 0 auto;\" />`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet meta = this.props.meta;\n\t\t\t\t\t\tmeta = omitBy( meta, ( _, value ) => {\n\t\t\t\t\t\t\treturn isNull( value );\n\t\t\t\t\t\t});\n\t\t\t\t\t\tmeta = jsyaml.dump( meta );\n\t\t\t\t\t\timg = `<img src=\"${this.state.plot}\" style=\"display: block; margin: 0 auto;\" data-plot-id=\"${this.props.id}\" data-plot-meta=\"${meta}\"></img>`;\n\t\t\t\t\t}\n\t\t\t\t\tev.dataTransfer.setData( 'text/html', img );\n\t\t\t\t}}\n\t\t\t>{this.props.t('drag-plot')}</div>;\n\t\t}\n\t\tconst { className, ...rest } = this.props;\n\t\treturn (\n\t\t\t<div className={`rplot ${className}`} style={{ minHeight: 128, cursor: 'pointer' }}>\n\t\t\t\t<Spinner running={this.state.waiting} width={256} height={128} />\n\t\t\t\t{ this.state.waiting ?\n\t\t\t\t\t<span /> :\n\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t{draggableBar}\n\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\tsrc={this.state.plotURL}\n\t\t\t\t\t\t\tbody={this.state.plot}\n\t\t\t\t\t\t\ttitle={this.props.t('r-plot')}\n\t\t\t\t\t\t\t{...rest}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Fragment>\n\t\t\t\t}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\n\n// PROPERTIES //\n\nRPlot.propTypes = {\n\tcode: PropTypes.string,\n\twidth: PropTypes.oneOfType([\n\t\tPropTypes.number,\n\t\tPropTypes.string\n\t]),\n\theight: PropTypes.oneOfType([\n\t\tPropTypes.number,\n\t\tPropTypes.string\n\t]),\n\tdraggable: PropTypes.bool,\n\tfileType: PropTypes.string,\n\tlibraries: PropTypes.array,\n\tprependCode: PropTypes.oneOfType([\n\t\tPropTypes.string,\n\t\tPropTypes.array\n\t]),\n\tmeta: PropTypes.object,\n\tclassName: PropTypes.string,\n\tonDone: PropTypes.func\n};\n\nRPlot.defaultProps = {\n\tcode: '',\n\twidth: 600,\n\theight: 'auto',\n\tdraggable: false,\n\tfileType: 'svg',\n\tlibraries: [],\n\tprependCode: '',\n\tmeta: null,\n\tclassName: '',\n\tonDone() {}\n};\n\nRPlot.contextType = SessionContext;\n\n\n// EXPORTS //\n\nexport default withTranslation( 'R' )( RPlot );\n"],"sourceRoot":""}